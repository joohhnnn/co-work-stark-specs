# Mastering the Stone Prover for Developers

## ç¬¬ 1 ç«  Stone Prover åœ¨ Starknet ç”Ÿæ€ä¸­çš„å®šä½

> æœ¬ç« ä¸ºå…¨ä¹¦å¥ å®š"ä¸ºä»€ä¹ˆéœ€è¦ Stone"ä¸"Stone å¤„åœ¨æµæ°´çº¿çš„å“ªä¸€ç¯"è¿™ä¸¤ä¸ªæ ¸å¿ƒè®¤çŸ¥ã€‚è¯»è€…è¯»å®Œåº”èƒ½åœ¨è„‘æµ·ä¸­ç”»å‡ºä¸€å¼ **ä» Cairo æºç åˆ°ä»¥å¤ªåŠ L1 éªŒè¯**çš„å®Œæ•´è·¯çº¿å›¾ï¼Œå¹¶ç†è§£ SHARP ä¸ Stone ä¹‹é—´çš„å…³ç³»ã€Stone å¼€æºå¯¹å»ä¸­å¿ƒåŒ–çš„æ„ä¹‰ï¼Œä»¥åŠ Sequencer åœ¨è¿è¡Œæ—¶å¦‚ä½•ä¸ Stone åä½œã€‚

---

### 1.0 åè¯æ¾„æ¸…ï¼šå¤šé‡ "Prover" çš„å±‚æ¬¡

åœ¨ Starknet ç”Ÿæ€é‡Œï¼Œ"Prover" ä¸€è¯åŒæ—¶æŒ‡ä»£ **åè®®è§’è‰²** ä¸ **è½¯ä»¶ç»„ä»¶**ï¼Œææ˜“æ··æ·†ã€‚åæ–‡è‹¥æ— ç‰¹åˆ«è¯´æ˜ï¼Œé»˜è®¤é‡‡ç”¨ä¸‹åˆ—çº¦å®šï¼š

| åç§° | æ‰€åœ¨å±‚ | ä¸»è¦èŒè´£ | å¯¹åº”ä»£ç ä»“åº“/ä½ç½® |
| --- | --- | --- | --- |
| â¶ Stone Prover **å¼•æ“** | å•æœºäºŒè¿›åˆ¶ | å°† Cairo è½¨è¿¹ + å…¬å…±è¾“å…¥ â†’ å•ç¬” STARK è¯æ˜ (`proof.json`) | `starkware-libs/stone-prover` C++ / Rust ç«¯å£ |
| â· Prover **æœåŠ¡/èŠ‚ç‚¹** | L2 off-chain è§’è‰² | æ‰¿è½½ Stone å¼•æ“ï¼Œå¯¹ Sequencer æš´éœ² `prove()` RPCï¼›å¯æ°´å¹³æ‰©å®¹ | `madara-prover-api`ã€`kabuki-prover` ç­‰ç¤¾åŒºé¡¹ç›® |
| â¸ SHARP (Shared **Prover**) | L2 åŸºç¡€è®¾æ–½ | æ”¶é›†å¤šæ¡å­è¯æ˜å¹¶åšé€’å½’èšåˆï¼Œè¾“å‡ºé“¾ä¸Šå¯éªŒè¯çš„**èšåˆè¯æ˜** | Starknet ç§æœ‰åç«¯ (å°†é€æ­¥å¼€æº) |
| â¹ ZK åè®®ä¸­çš„ **Prover** | å¯†ç å­¦æŠ½è±¡ | åœ¨äº¤äº’å¼/éäº¤äº’å¼ STARK åè®®é‡Œï¼Œå‘ Verifier å‘é€æ‰¿è¯º & å¼€æ”¾æŸ¥è¯¢ | ç†è®ºæ¦‚å¿µï¼Œç”± Stone åœ¨æœ¬åœ°æ¨¡æ‹Ÿ |

> ğŸ“Œ é€Ÿè¯»ï¼šæœ¬æ–‡ä¸»è¦èšç„¦ **â¶ Stone Prover å¼•æ“** çš„å®ç°ä¸å¦‚ä½•è¢« Sequencerï¼ˆæˆ– Prover æœåŠ¡ â·ï¼‰è°ƒç”¨ï¼›æåˆ° SHARP æˆ–åè®®å±‚ Prover è§’è‰²æ—¶ä¼šæ˜¾å¼æŒ‡æ˜ã€‚

---

### 1.1 Stone çš„åæ ‡ï¼šä» Cairo åˆ° L1 çš„æ•°æ®æµ

```mermaid
flowchart LR
    %% L2 å­å›¾
    subgraph L2["Starknet L2"]
        A["ç”¨æˆ·äº¤æ˜“<br/>(Cairo ç¨‹åº)"] --> B["Sequencer<br/>æ‰§è¡Œ & äº§å‡º Trace"]
        B --> C["Stone Prover<br/>ç”Ÿæˆ STARK è¯æ˜"]
        C --> D["SHARP<br/>é€’å½’èšåˆå¤šä¸ªè¯æ˜"]
    end

    %% L1 éªŒè¯
    D --> E["ä»¥å¤ªåŠ L1<br/>Verifier åˆçº¦"]
    E --> F["ç¡®è®¤çŠ¶æ€æ ¹<br/>& å‘å¸ƒæœ‰æ•ˆæ€§äº‹ä»¶"]
```

1. **ç”¨æˆ·å±‚**â€ƒå¼€å‘è€…æˆ– dApp åç«¯å°†ä¸šåŠ¡é€»è¾‘å†™æˆ Cairo ç¨‹åºå¹¶å‘èµ·äº¤æ˜“ã€‚
2. **Sequencer**â€ƒè´Ÿè´£æ’åºå¹¶æ‰§è¡Œäº¤æ˜“ï¼Œå¾—åˆ°**æ‰§è¡Œè½¨è¿¹ (Trace)** å’Œå…¬å…±è¾“å…¥ï¼ˆèµ·æ­¢çŠ¶æ€å“ˆå¸Œã€å…¬å…±å†…å­˜ç­‰ï¼‰ã€‚
3. **Stone Prover**â€ƒæ¥æ”¶ Trace/å…¬å…±è¾“å…¥ï¼Œç”Ÿæˆå•ç¬”äº¤æ˜“æˆ–å•æ‰¹äº¤æ˜“çš„ **STARK è¯æ˜**ã€‚
4. **SHARP (Shared Prover)**â€ƒæ‰¹é‡æ”¶é›†æ¥è‡ªå¤šåº”ç”¨ã€å¤šæ‰¹äº¤æ˜“çš„ Stone è¯æ˜ï¼Œé€šè¿‡**é€’å½’ STARK** æ±‡æ€»æˆå•ä¸ªé¡¶å±‚è¯æ˜ã€‚
5. **ä»¥å¤ªåŠéªŒè¯åˆçº¦**â€ƒåœ¨ä¸€ç¬”é“¾ä¸Šäº¤æ˜“ä¸­éªŒè¯èšåˆè¯æ˜ï¼›éªŒè¯æˆåŠŸå³ä»£è¡¨æ•´æ‰¹ L2 çŠ¶æ€æ›´æ–°åˆæ³•ã€‚

æ•°æ®æµçš„æ¯ä¸€æ­¥éƒ½é™„å¸¦å“ˆå¸Œæ‰¿è¯ºä¸éšæœºæŒ‘æˆ˜ï¼Œé˜²æ­¢ä¸­é€”ç¯¡æ”¹ï¼›Stone ç”Ÿäº§çš„åŸå§‹è¯æ˜ä»ä¸ç›´æ¥ä¸Šé“¾ï¼Œè€Œæ˜¯å…ˆç”± SHARP åšé€’å½’å‹ç¼©ï¼Œæ˜¾è‘—é™ä½éªŒè¯ Gas æˆæœ¬ â€” è¿™æ˜¯ Starknet æŠŠåƒä¸‡æ¬¡ Cairo æ­¥æ‰§è¡Œå‹ç¼©åˆ°ä¸€æ¬¡åˆçº¦è°ƒç”¨çš„å…³é”®ã€‚([docs.starknet.io][1], [docs.starknet.io][2])

---

### 1.2 SHARPï¼šå…±äº«è¯æ˜ä¸é€’å½’èšåˆçš„è¯ç”ŸåŸå› 

> **"åƒæ­åœ°é“ä¸€æ ·å…±äº«ä¸€å¼ è½¦ç¥¨ã€‚"**

* **æˆæœ¬åˆ†æ‘Š**â€ƒåœ¨æ—©æœŸï¼ˆæ— é€’å½’ï¼‰æ¨¡å¼ä¸‹ï¼Œä¸€æ¡ Cairo ç¨‹åºå°±è¦å•ç‹¬æäº¤ä¸€æ¬¡ L1 éªŒè¯ï¼Œæ‰‹ç»­è´¹æ˜‚è´µã€‚SHARP é€šè¿‡æŠŠå¤šæ¡ç¨‹åºçš„å­è¯æ˜å è¿›åŒä¸€"è¯æ˜åˆ—è½¦ (proof train)"ä¸­ï¼Œè®©åº”ç”¨æŒ‰æ¯”ä¾‹å¹³æ‘Šé“¾ä¸Šæˆæœ¬ã€‚
* **é€’å½’ STARK**â€ƒSHARP ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„ Cairo éªŒè¯ç¨‹åºéªŒè¯æ‰€æœ‰å­è¯æ˜ï¼›è¯¥éªŒè¯ç¨‹åºæœ¬èº«å†äº¤ç»™ Stone Prover è¯æ˜ï¼Œäºæ˜¯ **"è¯æ˜éªŒè¯è¯æ˜"** çš„é€’å½’é“¾å°±å½¢æˆäº†ã€‚æ·±åº¦é€šå¸¸ 2â€“3 å±‚å³å¯æŠŠåƒç™¾ä¸ªå­è¯æ˜å‹æˆä¸€ä¸ªé“¾ä¸Šè¯æ˜ã€‚
* **å¹¶è¡ŒåŒ–**â€ƒé€’å½’å¸¦æ¥çš„é™„èµ å¥½å¤„æ˜¯å¹¶è¡Œï¼šN æ¡å­è¯æ˜å¯åœ¨å¤šå°æœºå™¨åŒæ—¶è·‘ Stoneï¼›èšåˆå±‚å†å•ç‹¬è·‘ä¸€æ¬¡ï¼Œç«¯åˆ°ç«¯å»¶è¿Ÿâ‰ˆ"æœ€æ…¢å­è¯æ˜ + èšåˆæ—¶é—´"ï¼Œè€Œéä¸²è¡Œç´¯åŠ ã€‚

å¼€å‘è€…æƒ³è¦æ¥å…¥ SHARP åªéœ€ä¸Šä¼  Cairo ç¨‹åºä¸è¾“å…¥æ•°æ®ï¼Œåç«¯ä¼šæ”¶åˆ°æœ€ç»ˆè¯æ˜å“ˆå¸Œå’Œ L1 äº‹åŠ¡ IDï¼›å…¶ä½™ç¹æ‚æµç¨‹ï¼ˆæ‰¹æ¬¡è°ƒåº¦ã€é€’å½’æ·±åº¦é€‰æ‹©ã€å¤±è´¥å›æ»šï¼‰éƒ½è¢« SHARP åç«¯å±è”½ã€‚([docs.starknet.io][1], [starknet.io][3])

---

### 1.3 Stone å¼€æºï¼šä»é»‘ç›’åˆ°ç¤¾åŒºå…±å»º

| é‡Œç¨‹ç¢‘     | äº‹ä»¶                                                     | å½±å“                    |
| ------- | ------------------------------------------------------ | --------------------- |
| 2020 Q4 | Stone æŠ•å…¥ StarkEx ç”Ÿäº§ï¼ŒéªŒè¯æ•°åäº¿æ¬¡äº¤æ˜“                           | è¯æ˜å¼•æ“çš„å¯é æ€§é¦–æ¬¡ç»ä¸»ç½‘è€ƒéªŒ       |
| 2023-02 | StarkWare å®£å¸ƒå°†å¼€æº Stone                                  | æ ‡å¿— Starknet å»ä¸­å¿ƒåŒ–æŠ€æœ¯æ ˆè·¯çº¿ |
| 2023-08 | **Stone Prover v0.1** (â‰ˆ100 k C++) **Apache-2.0** è®¸å¯é‡Šå‡º | ä»»ä½•å¼€å‘è€…éƒ½å¯å®¡è®¡ã€å¤ç”¨ã€ç§»æ¤ã€æ”¹è¿›    |
| 2024-04 | ç¤¾åŒº Rust ç‰ˆç§»æ¤ã€GPU FFT å®éªŒ                                 | å¼€å¯å¤šè¯­è¨€ã€å¤šåç«¯ä¼˜åŒ–ç«èµ›         |

å¼€æºå¸¦æ¥çš„ä»·å€¼ï¼š

* **é€æ˜å®‰å…¨**â€ƒæ›´å¤šå®‰å…¨ç ”ç©¶è€…å®¡è®¡ä»£ç ï¼ŒåŠæ—¶å‘ç°æ½œåœ¨å®ç°æ¼æ´ã€‚
* **æ€§èƒ½è¿­ä»£**â€ƒç¤¾åŒºå·²è´¡çŒ®å¹¶è¡Œæ·±åº¦ä¼˜åŒ–ã€æ›¿æ¢ SIMD å“ˆå¸Œç­‰ PRï¼›Stone æ€§èƒ½åœ¨ 18 ä¸ªæœˆå†…æå‡çº¦ 2â€“3 å€ã€‚
* **å»ä¸­å¿ƒåŒ–è·¯çº¿**â€ƒæœªæ¥ Starknet æ‰“ç®—è®©ä»»ä½•äººéƒ½èƒ½è¿è¡ŒéªŒè¯èŠ‚ç‚¹å’Œè¯æ˜èŠ‚ç‚¹ï¼ŒStone å¼€æºæ˜¯ç¬¬ä¸€å—æ‹¼å›¾ã€‚
* **æ•™è‚²èµ„æº**â€ƒé«˜æ ¡åŠç ”ç©¶æœºæ„å¯åœ¨è¯¾å ‚æˆ–è®ºæ–‡ä¸­ç›´æ¥å¼•ç”¨ç»æˆ˜ç«éªŒè¯çš„ STARK ä»£ç åº“ï¼Œä¿ƒè¿› ZK äººæ‰åŸ¹å…»ã€‚

> *"æˆ‘ä»¬æŠŠé­”æ–äº¤ç»™äº†å¼€å‘è€…ã€‚"* â€” StarkWare CTO Eli Ben-Sasson åœ¨ 2023 Starknet Summit ä¸Šå¦‚æ˜¯è¯´ã€‚([starkware.co][4], [starkware.co][5], [CoinDesk][6], [Medium][7])

---

### 1.4 Stone Ã— Sequencerï¼šRollup å®‰å…¨å¸¦çš„åŒæ‰£ç¯

<div align="center">

| Sequencer è´£ä»»               | Stone Prover è´£ä»»            |
| -------------------------- | -------------------------- |
| æŒ‰äº¤æ˜“æ¬¡åºæ‰§è¡Œ Cairo VM           | æ ¹æ®æ‰§è¡Œ Trace ç”Ÿæˆ STARK è¯æ˜     |
| äº§å‡ºæ–°çŠ¶æ€æ ¹ã€äº‹ä»¶æ—¥å¿—                | è¾“å‡º `proof.json` ç»™ SHARP èšåˆ |
| å‘ mempool å¹¿æ’­ L2 âœ• L1 batch | ç¡®ä¿è¯æ˜ä¸å…¬å…±è¾“å…¥å“ˆå¸Œä¸€è‡´              |
| æ£€æµ‹ L1 ç¡®è®¤å›æ‰§å¹¶æ›´æ–°é“¾å¤´            | åœ¨è¯æ˜å¤±è´¥/è¶…æ—¶æ—¶å›æ»š batch          |

</div>

**äº¤äº’æµç¨‹**

1. **æ‰§è¡Œé˜¶æ®µ**â€ƒSequencer åœ¨ç”Ÿæˆæ–°åŒºå—æ—¶æœ¬åœ°è·‘ Cairo VMï¼›åŒæ—¶ç¼“å­˜æ‰§è¡Œ Traceï¼ˆ~GB çº§ï¼‰ã€‚
2. **è¯æ˜é˜¶æ®µ**â€ƒSequencer è°ƒç”¨æœ¬æœºæˆ–è¿œç¨‹ Stone å®ä¾‹ `POST /prove`ï¼Œæäº¤ Trace å’Œ `public_input.json`ã€‚Stone è¿›å…¥æµæ°´çº¿ï¼šæ’å€¼â€’ç»„åˆâ€’æ‰¿è¯ºâ€’FRIâ€’è¾“å‡ºã€‚
3. **èšåˆé˜¶æ®µ**â€ƒStone äº§å‡ºçš„ `proof.json` ä¸Šä¼ è‡³ SHARPï¼Œç­‰å¾…é€’å½’èšåˆã€‚Sequencer å°† L1 CallData ä¸­å¡«å…¥æœ€ç»ˆèšåˆè¯æ˜å“ˆå¸Œå’Œæ‰¹æ¬¡çŠ¶æ€æ ¹ã€‚
4. **ç¡®è®¤é˜¶æ®µ**â€ƒä»¥å¤ªåŠåˆçº¦éªŒè¯æˆåŠŸåè§¦å‘ `ProofVerified` äº‹ä»¶ï¼ŒSequencer ç›‘å¬è¯¥äº‹ä»¶å›å†™æœ¬åœ°æ•°æ®åº“ï¼Œæ ‡è®°åŒºå—"finalized"ã€‚

**æ•…éšœåˆ†çº§**

| åœºæ™¯            | å¤„ç†ç­–ç•¥                                           |
| ------------- | ---------------------------------------------- |
| Stone è¯æ˜å¤±è´¥    | Sequencer ä¸¢å¼ƒåŒºå—å¹¶å›æ»š mempoolï¼›å¹¿æ’­ "proof-failed" äº‹ä»¶ |
| Stone è€—æ—¶è¶… SLA | å°†æ‰¹æ¬¡æ‹†åˆ†ä¸ºæ›´å°ç‰‡æ®µé‡è¯•ï¼›æˆ–é™çº§ä½¿ç”¨å¤‡ç”¨ Prover                    |
| L1 éªŒè¯å¤±è´¥       | è¿›å…¥ç´§æ€¥åœæœºæ¨¡å¼ï¼Œé˜»æ–­è¿›ä¸€æ­¥å‡ºå—ï¼Œç­‰å¾…äººå·¥æ’æŸ¥                        |

é€šè¿‡è®© **æ‰§è¡Œ (Sequencer)** ä¸ **è¯æ˜ (Stone)** ç›¸äº’æ ¡éªŒï¼ŒStarknet æŠŠ "çŠ¶æ€è½¬ç§»æ­£ç¡®æ€§" ä¸ "æœ‰æ•ˆæ€§å¯è¯æ˜" ç»‘æˆåŒä¿é™©ï¼šåªè¦æœ‰ä¸€æ–¹å‡ºé”™ï¼Œå¦ä¸€æ–¹å°±ä¼šæ‹’ç»ç»§ç»­æ¨è¿›æ–°åŒºå—ï¼Œä»è€Œé¿å…é”™è¯¯æ»šå…¥ L1ã€‚([docs.starknet.io][2], [GitHub][8])

---


[1]: https://docs.starknet.io/architecture-and-concepts/sharp/?utm_source=chatgpt.com "The Shared Prover (SHARP) - Starknet documentation"
[2]: https://docs.starknet.io/architecture-and-concepts/provers-overview/?utm_source=chatgpt.com "Provers - Starknet documentation"
[3]: https://www.starknet.io/blog/recursive-starks/?utm_source=chatgpt.com "Recursive STARKs - Starknet"
[4]: https://starkware.co/blog/open-sourcing-the-battle-tested-stone-prover/?utm_source=chatgpt.com "Open-Sourcing the Battle-Tested Stone Prover - StarkWare"
[5]: https://starkware.co/blog/unleashing-the-power-of-the-stone-prover/?utm_source=chatgpt.com "Unleashing the power of the Stone Prover - StarkWare"
[6]: https://www.coindesk.com/tech/2023/08/22/starkware-to-open-source-magic-wand-of-its-zero-knowledge-cryptography-next-week?utm_source=chatgpt.com "Starkware to Open-Source 'Magic Wand' of Its Zero ... - CoinDesk"
[7]: https://medium.com/%40meison_crypto/starkwares-stone-prover-unshackling-the-power-of-open-source-1d8a471dcea4?utm_source=chatgpt.com "StarkWare's Stone Prover: Unshackling the Power of Open Source"
[8]: https://github.com/starkware-libs/stone-prover?utm_source=chatgpt.com "starkware-libs/stone-prover - GitHub"


## ç¬¬2ç«  Stone Prover æ€»ä½“æ¶æ„

æœ¬ç« å°†å›´ç»• Stone Prover çš„æºç ç»“æ„å’Œæ¨¡å—è®¾è®¡ï¼Œç³»ç»Ÿé˜è¿°å…¶æ€»ä½“æ¶æ„ã€‚Stone Prover ä½œä¸º StarkWare å¼€æºçš„ STARK è¯æ˜ç³»ç»Ÿï¼Œå…¶ä»£ç åˆ’åˆ†ä¸ºè‹¥å¹²æ ¸å¿ƒæ¨¡å—ï¼ŒåŒ…æ‹¬ Cairo **CPU AIR**ï¼ˆä»£æ•°ä¸­é—´è¡¨ç¤ºï¼Œç”¨äºæè¿° Cairo VM çš„çº¦æŸä½“ç³»ï¼‰ã€**ä¿¡é“ï¼ˆProverChannelï¼‰**ã€**ç»„åˆå¤šé¡¹å¼**ã€**å¤šé¡¹å¼æ‰¿è¯ºæœºåˆ¶**ä»¥åŠ **FRI**ï¼ˆå¿«é€Ÿ Reed-Solomon ä½åº¦è¯æ˜ï¼‰ ç­‰ã€‚è¿™äº›æ¨¡å—å„å¸å…¶èŒï¼Œåˆé€šè¿‡æ˜ç¡®çš„æ•°æ®å’Œæ§åˆ¶æµè¡”æ¥åœ¨ä¸€èµ·ï¼ŒååŒå®Œæˆä»æ‰§è¡Œè½¨è¿¹åˆ°æœ€ç»ˆ STARK è¯æ˜çš„ç”Ÿæˆã€‚æœ¬ç« é¦–å…ˆç»™å‡º Stone Prover å†…éƒ¨æµç¨‹çš„æ¦‚è§ˆï¼Œéšååˆ†åˆ«ä»‹ç»å„å…³é”®ç»„ä»¶çš„èŒè´£å’Œå®ç°ï¼ŒåŒ…æ‹¬å®ƒä»¬ä¹‹é—´çš„è°ƒç”¨å…³ç³»å’Œæ•°æ®äº¤äº’ã€‚

### 2.1 æ¶æ„æ¦‚è§ˆä¸ä¸»æµç¨‹

Stone Prover æ¥å— Cairo ç¨‹åºçš„æ‰§è¡Œ**è½¨è¿¹ï¼ˆtraceï¼‰**åŠå…¬å…±è¾“å…¥/ç§æœ‰è¾“å…¥ï¼Œè¾“å‡ºå¯éªŒè¯çš„ STARK è¯æ˜ã€‚å›¾2-1æ¦‚æ‹¬äº†è¯æ˜è¿‡ç¨‹ä¸­å„æ¨¡å—çš„äº¤äº’æµç¨‹ï¼š

1. **è½¨è¿¹è¾“å…¥ä¸ AIR**ï¼šé¦–å…ˆï¼ŒCairo ç¨‹åºç¼–è¯‘ä¸º CASM åç”± Stone æ‰§è¡Œï¼Œç”Ÿæˆå®Œæ•´çš„æ‰§è¡Œè½¨è¿¹ï¼ˆå¯„å­˜å™¨å’Œå†…å­˜çš„é€æ­¥å–å€¼ï¼‰ã€‚è¯¥è½¨è¿¹å°†äº¤ç”± Cairo **AIR**ï¼ˆä¾‹å¦‚ `CpuAir` ç±»ï¼‰éªŒè¯å…¶åˆæ³•æ€§ã€‚AIR å®šä¹‰äº†çº¦æŸç³»ç»Ÿï¼Œç”¨å¤šé¡¹å¼ç­‰å¼åˆ»ç”»åˆæ³•çš„çŠ¶æ€è¿ç§»è§„åˆ™ã€‚Stone Prover åˆå§‹åŒ– AIR æ¨¡å—å®ä¾‹ï¼ˆå¦‚ `CpuAir`ï¼‰ï¼Œè½½å…¥è½¨è¿¹å’Œç›¸å…³çš„å…¬å…±å‚æ•°ï¼ˆä¾‹å¦‚æ­¥éª¤æ•°ã€å†…å­˜æ®µä¿¡æ¯ç­‰ï¼‰ã€‚

2. **ä¿¡é“åˆå§‹åŒ–ï¼ˆFiat-Shamirï¼‰**ï¼šStone Prover æ¥ç€åˆå§‹åŒ–**éäº¤äº’ä¿¡é“**ï¼ˆ`ProverChannel`ï¼‰ï¼Œåˆ©ç”¨ Fiat-Shamir å˜æ¢å°†äº¤äº’å¼è¯æ˜è½¬åŒ–ä¸ºéäº¤äº’å½¢å¼ã€‚ä¿¡é“ä»¥å…¬å¼€å‚æ•°ä¸ºåˆå§‹ç§å­æ›´æ–°å“ˆå¸ŒçŠ¶æ€ï¼Œä¾‹å¦‚ `CpuAir` ä¼šç”¨è½¨è¿¹é•¿åº¦ã€å†…å­˜åˆ©ç”¨ç­‰å…¬å¼€è¾“å…¥æ¥åˆå§‹åŒ– transcriptã€‚è¿™ä¸€æ­¥ç¡®ä¿è¯æ˜è€…å’ŒéªŒè¯è€…å…±äº«ç›¸åŒçš„éšæœºæ€§æ¥æºã€‚

3. **è½¨è¿¹å¤šé¡¹å¼æ‰¿è¯º**ï¼šStone Prover å°†æ‰§è¡Œè½¨è¿¹å„åˆ—ï¼ˆå¯„å­˜å™¨åˆ—ã€å†…å­˜åˆ—ç­‰ï¼‰è§†ä½œç¦»æ•£ç‚¹ä¸Šçš„å¤šé¡¹å¼ï¼Œå°†å…¶åœ¨æ‰©å±•åŸŸä¸Šè¯„ä¼°åæäº¤ç»™**å¤šé¡¹å¼æ‰¿è¯ºæœºåˆ¶**ã€‚å…·ä½“å®ç°ä¸Šï¼ŒStone æ„é€ ä¸€ä¸ª `TableProver`ï¼ˆè¡¨è¯æ˜å™¨ï¼‰æ¥å¤„ç†å¤šåˆ—æ•°ç»„çš„æ‰¿è¯ºï¼Œè¯¥è¡¨è¯æ˜å™¨å†…éƒ¨å°è£…äº†ä¸€ä¸ª `CommitmentSchemeProver` å®ä¾‹ç”¨äºæ„å»º Merkle æ ‘ã€‚åœ¨æ ‡å‡†æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è½¨è¿¹åˆ—åœ¨æ‰©å±•åŸŸä¸Šçš„å–å€¼ï¼ˆLDEï¼Œé•¿åº¦ä¸ºåŸè½¨è¿¹é•¿åº¦çš„æŸå€ï¼‰å¯ä»¥æ”¾å…¥å†…å­˜ï¼›Stone å…ˆæŒ‰ **ä½åè½¬é¡ºåº**é‡æ’è¿™äº›è¯„å€¼çš„è¡Œåºï¼Œç„¶åå°†æ¯è¡Œå„åˆ—çš„å€¼ä¸²è”å“ˆå¸Œä½œä¸ºå¶å­èŠ‚ç‚¹ã€‚å¦‚æ­¤å¾—åˆ°çš„ Merkle æ ‘æ ¹å³ä¸ºå¯¹è½¨è¿¹å¤šé¡¹å¼çš„åŠ å¯†æ‰¿è¯ºã€‚ProverChannel éšåé€šè¿‡ `SendBytes` æ“ä½œå°†è¯¥æ ¹å“ˆå¸Œå‘é€ï¼ˆé™„åŠ ï¼‰åˆ° transcriptã€‚æ­¤æ—¶ï¼Œä¿¡é“æ ¹æ®å½“å‰ transcript çŠ¶æ€è¾“å‡ºç¬¬ä¸€ä¸ªéšæœºæŒ‘æˆ˜ï¼ˆé€šè¿‡ `ReceiveBytes`ï¼‰ï¼Œè®°ä½œ Î±ï¼Œç”¨äºä¸‹ä¸€é˜¶æ®µç»„åˆå¤šé¡¹å¼çš„éšæœºç³»æ•°ã€‚

4. **ç»„åˆå¤šé¡¹å¼æ„å»º**ï¼šæ”¶åˆ°æŒ‘æˆ˜ Î± åï¼ŒStone Prover éšå³å¯åŠ¨**ç»„åˆå¤šé¡¹å¼**æ„å»ºè¿‡ç¨‹ã€‚ç»„åˆå¤šé¡¹å¼å°† AIR å®šä¹‰çš„æ‰€æœ‰çº¦æŸè¯„ä¼°åˆæˆä¸ºå•ä¸€å¤šé¡¹å¼ï¼Œä»¥ç¡®ä¿çº¦æŸæ£€æµ‹å¯é€šè¿‡ä¸€æ¬¡å¤šé¡¹å¼ç­‰å¼éªŒè¯å®Œæˆã€‚Stone ä¸­ `CompositionPolynomial` æŠ½è±¡ç±»å®šä¹‰äº†ç»„åˆå¤šé¡¹å¼çš„æ¥å£ï¼Œç”± `CompositionPolynomialImpl` æä¾›å®ç°ã€‚Prover ä¼šå®ä¾‹åŒ–ä¸€ä¸ª `CompositionOracleProver`ï¼Œå†…éƒ¨æŒæœ‰è‹¥å¹²è½¨è¿¹å¤šé¡¹å¼çš„å¼•ç”¨ï¼ˆæ­¤å‰å·²ç»æ‰¿è¯ºçš„è½¨è¿¹åˆ—ï¼‰ä»¥åŠå½“å‰ä¿¡é“å¯¹è±¡ã€‚éšåï¼ŒProver ä½¿ç”¨æŒ‘æˆ˜ Î± ä½œä¸ºéšæœºæƒé‡ï¼Œè°ƒç”¨ `Air::ConstraintsEval` æ¥è®¡ç®—æ¯ä¸ªè¸ªè¿¹ç‚¹å¤„æ‰€æœ‰çº¦æŸçš„çº¿æ€§ç»„åˆå€¼ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒStone å°†æ‰€æœ‰çº¦æŸå¤šé¡¹å¼æŒ‰ä¸€å®šæ¬¡åºä¹˜ä¸Š**åŒä¸€éšæœºæŒ‘æˆ˜çš„ä¸åŒå¹‚æ¬¡**å†æ±‚å’Œï¼Œå½¢æˆç»„åˆå¤šé¡¹å¼è¯„å€¼ã€‚è¿™ç§è®¾è®¡é¿å…ä¸ºæ¯æ¡çº¦æŸå¼•å…¥ç‹¬ç«‹éšæœºæ•°ï¼Œå‡å°‘äº†éªŒè¯ç«¯éœ€è¦å­˜å‚¨çš„æŒ‘æˆ˜æ•°é‡ã€‚ç»„åˆå¤šé¡¹å¼çš„è¯„å€¼è®¡ç®—å¯ä»¥å¹¶è¡ŒåŒ–å®Œæˆï¼šStone çš„å®ç°ä¼šå°†æ‰©å±•åŸŸåˆ’åˆ†ä¸ºè‹¥å¹²ä½™å¼ç±»ï¼ˆcosetï¼‰åˆ†ç‰‡ï¼Œåˆ©ç”¨å¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—æ¯ä¸ª coset ä¸Šç»„åˆå¤šé¡¹å¼çš„å–å€¼ã€‚è®¡ç®—å®Œæˆåå¾—åˆ°ç»„åˆå¤šé¡¹å¼ \$H(X)\$ åœ¨æ•´ä¸ª LDE åŸŸä¸Šçš„å–å€¼é›†åˆã€‚

   å¦‚æœç»„åˆå¤šé¡¹å¼ \$H(X)\$ çš„é˜¶è¶…è¿‡åŸè½¨è¿¹é•¿åº¦ \$2^n\$ï¼ŒStone ä¼šå°†å…¶**æ‹†åˆ†**ä¸º \$d\$ ä¸ªéƒ¨åˆ†ä»¥æ–¹ä¾¿æ‰¿è¯ºä¸éªŒè¯ï¼Œä½¿ \$H(X) = H\_0(X^d) + X\cdot H\_1(X^d) + \cdots + X^{d-1}\cdot H\_{d-1}(X^d)\$ã€‚Stone é€šè¿‡å¯¹ \$H\$ çš„è¯„å€¼æ‰§è¡Œè‹¥å¹²æ­¥éƒ¨åˆ†åå‚…é‡Œå¶å˜æ¢ï¼ˆIFFTï¼‰ç›´æ¥å¾—åˆ°å„å­å¤šé¡¹å¼ \$H\_i\$ çš„è¯„å€¼ï¼Œé¿å…å®Œæ•´æ’å€¼å†æ‹†åˆ†çš„é«˜å¼€é”€ã€‚éšåï¼ŒStone å†æ¬¡ä½¿ç”¨ `TableProver` å¯¹ç»„åˆå¤šé¡¹å¼è¯„å€¼ï¼ˆå¯èƒ½æ˜¯å¤šåˆ—ï¼Œå¯¹åº” \$H\_0...H\_{d-1}\$ï¼‰è¿›è¡Œ Merkle æ ‘æ‰¿è¯ºï¼Œè·å–ç»„åˆå¤šé¡¹å¼çš„æ‰¿è¯ºæ ¹ã€‚ProverChannel å°†è¯¥æ ¹å‘é€è‡³ transcript å¹¶å¾—åˆ°ä¸‹ä¸€ä¸ªéªŒè¯è€…éšæœºæŒ‘æˆ˜ Î²ã€‚

5. **åŸŸå¤–é‡‡æ ·æ£€æŸ¥ï¼ˆDEEP ç»„åˆå¤šé¡¹å¼ï¼‰**ï¼šæŒ‘æˆ˜ Î² æ˜¯éªŒè¯è€…é€‰å–çš„**åŸŸå¤–é‡‡æ ·ç‚¹** \$z\$ï¼ˆå³ä¸å±äºåŸå§‹è¯„å€¼åŸŸçš„éšæœºç‚¹ï¼‰ã€‚Stone Prover åˆ©ç”¨æ­¤ \$z\$ å¯¹æ­¤å‰çš„ç»“æœè¿›è¡Œä¸€è‡´æ€§æ£€æŸ¥ï¼šé¦–å…ˆè®¡ç®—è½¨è¿¹å¤šé¡¹å¼å’Œç»„åˆå¤šé¡¹å¼åœ¨ç‚¹ \$z\$ å¤„çš„å–å€¼ã€‚æŒ‰ç…§ STARK åè®®è¦æ±‚ï¼Œå¦‚æœè½¨è¿¹æ»¡è¶³æ‰€æœ‰çº¦æŸï¼Œåˆ™ç»„åˆå¤šé¡¹å¼åœ¨ \$z\$ ç‚¹çš„å€¼åº”ä¸ºé›¶ï¼ˆå› ä¸ºçº¦æŸè¢«éšæœºçº¿æ€§ç»„åˆåˆ°ä¸€èµ·ï¼‰ã€‚ä¸ºäº†å°†è¿™ä¸€æ£€æŸ¥çº³å…¥å¤šé¡¹å¼è¯æ˜ä½“ç³»ä¸­ï¼ŒStone æ„é€ äº†**æ·±åº¦ç»„åˆå¤šé¡¹å¼**ï¼ˆDEEP composition polynomialï¼‰ï¼Œä¹Ÿå«åŸŸå¤–çº¦æŸå¤šé¡¹å¼ã€‚Stone çš„å®ç°å·§å¦™åœ°é‡ç”¨äº†åŸç»„åˆå¤šé¡¹å¼çš„åŸºç¡€è®¾æ–½ï¼šå¼•å…¥ä¸€ä¸ªç‰¹æ®Šçš„ AIR ç±» `BoundaryAIR` æ¥è¡¨ç¤ºä»…åœ¨ \$z\$ ç‚¹æ£€æŸ¥çº¦æŸçš„"ä¼ª AIR"ã€‚Stone ä½¿ç”¨è¯¥ `BoundaryAIR` å’Œæ­¤å‰çš„æŒ‘æˆ˜å€¼ï¼ˆå®é™…ä¸ŠéªŒè¯è€…ä¼šå†ç»™ä¸€æ¬¡æŒ‘æˆ˜ï¼Œåœ¨æ—¥å¿—ä¸­ä½“ç°ä¸ºä¸¤æ¬¡ç›¸åŒç±»åˆ«çš„éšæœºæ•°ï¼‰æ„å»ºå‡ºæ·±åº¦ç»„åˆå¤šé¡¹å¼ï¼Œå¹¶è®¡ç®—å…¶åœ¨æ‰©å±•åŸŸä¸Šçš„å–å€¼é›†åˆã€‚è¿™ä¸ªæ·±åº¦ç»„åˆå¤šé¡¹å¼åœ¨ç†è®ºä¸Šåº”å½“ä»…åœ¨ \$X=z\$ å¤„å¯èƒ½ä¸ºéé›¶ï¼Œå¦åˆ™å¯¹åº”çš„è¯æ˜å°†æ— æ³•é€šè¿‡éªŒè¯ã€‚Stone éšåå¯¹æ·±åº¦ç»„åˆå¤šé¡¹å¼çš„è¯„å€¼å†æ¬¡æ‰§è¡Œæ‰¿è¯ºï¼ˆMerkle æ ‘æ„é€ ï¼‰ï¼Œå°†å…¶æ ¹å“ˆå¸Œé€å…¥ transcriptã€‚ç”±äº FRI é˜¶æ®µä¸éœ€è¦æ–°çš„ç‹¬ç«‹éšæœºæ•°ï¼Œè¿™é‡Œé€šå¸¸ä¸å†ä»ä¿¡é“è·å–æ–°çš„æŒ‘æˆ˜ï¼Œè€Œæ˜¯ç›´æ¥è¿›å…¥ä½åº¦è¯æ˜è¿‡ç¨‹ã€‚

6. **FRI ä½åº¦è¯æ˜**ï¼šåœ¨ç»è¿‡ä»¥ä¸Šæ­¥éª¤åï¼ŒStone Prover å·²æ‰¿è¯ºäº†æœ€ç»ˆéœ€è¦éªŒè¯ä½é˜¶æ€§çš„ç›®æ ‡å¤šé¡¹å¼ï¼ˆå³æ·±åº¦ç»„åˆå¤šé¡¹å¼ï¼Œå®ƒå…¼å…·äº†çº¦æŸå’Œè¾¹ç•Œæ£€æŸ¥è¦æ±‚ï¼‰ã€‚æ¥ä¸‹æ¥è¿›å…¥ FRIï¼ˆFast Reed-Solomon IOPPï¼‰é˜¶æ®µï¼Œé€šè¿‡å¤šè½®å¤šé¡¹å¼æŠ˜å å’Œéšæœºé‡‡æ ·æ¥è¯æ˜è¯¥å¤šé¡¹å¼åº¦æ•°ä½äºé¢„å®šä¸Šé™ã€‚Stone å®ç°åŒ…å«ä¸€ä¸ª `FriProver` ç±»ï¼ˆå¿«é€Ÿä½åº¦è¯æ˜å™¨ï¼‰ï¼Œå†…éƒ¨ä¼šç”Ÿæˆä¸€ç³»åˆ—æŒ‰æŒ‡æ•°é€’å‡é•¿åº¦çš„**FRIå±‚**ã€‚åˆå§‹å±‚å³æ·±åº¦ç»„åˆå¤šé¡¹å¼åœ¨ LDE åŸŸä¸Šçš„è¯„å€¼ï¼Œ`FriProver` ä½¿ç”¨ `FriFolder` å°†ç›¸é‚»ä¸¤ç‚¹çš„è¯„å€¼ç»„åˆï¼ˆä¾‹å¦‚å°†ç¬¬\$i\$ç‚¹å’Œç¬¬\$i+\frac{N}{2}\$ç‚¹åˆå¹¶ï¼‰è®¡ç®—ä¸‹ä¸€å±‚çš„æ–°è¯„å€¼ã€‚è¿™ä¸€æŠ˜å è¿‡ç¨‹ç­‰æ•ˆäºå¯¹å¤šé¡¹å¼åšä¸€æ¬¡åº¦æŠ˜åŠå˜æ¢ï¼Œä½¿å¤šé¡¹å¼åº¦æ•°ä¸Šç•Œå‡åŠã€‚Stone çš„ FRI å®ç°æ”¯æŒéš”å±‚æ‰¿è¯ºçš„ä¼˜åŒ–â€”â€”ä¾‹å¦‚åªå¯¹æ¯ç¬¬ä¸‰å±‚å»ºç«‹ Merkle æ ‘â€”â€”ä»¥å‡å°‘è¯æ˜å¤§å°ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹é»˜è®¤æ¯å±‚éƒ½æ‰¿è¯ºä»¥ç®€åŒ–å®ç°ã€‚å¯¹äºæ¯ä¸€å±‚ç”Ÿæˆçš„è¯„å€¼æ•°ç»„ï¼ŒStone å‡æ„å»ºå¯¹åº”çš„ Merkle æ ‘å¹¶è®°å½•å…¶æ ¹ï¼›FRI è¿‡ç¨‹ä¸€ç›´æŒç»­åˆ°å¤šé¡¹å¼è¯„å€¼æ•°é‡é™è‡³é¢„è®¾çš„é˜ˆå€¼ï¼ˆæ¯”å¦‚ 2 çš„å‡ ä½•çº§æ•°å‡è‡³å‡ åä¸ªç‚¹ï¼‰æ—¶åœæ­¢ã€‚æ­¤æ—¶ï¼ŒProver ç›´æ¥å¯¹æœ€åä¸€å±‚çš„è¯„å€¼æ‰§è¡Œæ’å€¼ï¼Œæ±‚å¾—ä¸€ä¸ªæ˜¾å¼çš„ä½é˜¶å¤šé¡¹å¼ç³»æ•°è¡¨ç¤ºï¼Œå¹¶å°†è¿™äº›ç³»æ•°ä½œä¸ºè¯æ˜çš„ä¸€éƒ¨åˆ†å‘é€ã€‚è¿™ç§"æå‰ç»ˆæ­¢"ä¼˜åŒ–é¿å…äº†å°†æœ€åå‡ å±‚çš„å¤§é‡ç‚¹å’Œå€¼éƒ½çº³å…¥è¯æ˜ï¼Œå‡å°äº†è¯æ˜å°ºå¯¸ã€‚

7. **éšæœºæŸ¥è¯¢ä¸è¯æ˜è¾“å‡º**ï¼šåœ¨éäº¤äº’æ¨¡å¼ä¸‹ï¼ŒéªŒè¯è€…æŒ‘æˆ˜å¾€å¾€å»¶ååˆ°æ‰€æœ‰æ‰¿è¯ºè¾“å‡ºåå†ç»Ÿä¸€é‡‡æ ·æŸ¥è¯¢ä½ç½®ã€‚Stone Prover åœ¨æœ€åä¸€è½®æ‰¿è¯ºï¼ˆæˆ–æä¾›æœ€åå¤šé¡¹å¼ç³»æ•°ï¼‰åï¼Œä¼šåˆ©ç”¨ä¿¡é“åŸºäºå½“å‰ transcript çŠ¶æ€ç”Ÿæˆä¸€ç³»åˆ—**æŸ¥è¯¢ç´¢å¼•**ï¼ˆé€šå¸¸æ˜¯è‹¥å¹²ä¸ªéšæœºä½ç½®ï¼‰ï¼Œç”¨äºæŠ½æŸ¥å…ˆå‰æ‰€æœ‰æ‰¿è¯ºçš„ä¸€è‡´æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºéªŒè¯æ‰€éœ€çš„æ¯ä¸€ä¸ªæŸ¥è¯¢ç´¢å¼• \$i\$ï¼Œè¯æ˜è€…å°†æä¾›ï¼šè½¨è¿¹å¤šé¡¹å¼åœ¨å¯¹åº”ä½ç½®çš„æ‰€æœ‰åˆ—å€¼ã€ç»„åˆå¤šé¡¹å¼åœ¨ç›¸å…³ä½ç½®çš„å€¼ã€æ·±åº¦ç»„åˆå¤šé¡¹å¼åœ¨ä½ç½®çš„å€¼ã€ä»¥åŠå„ FRI å±‚åœ¨ç›¸åº”è¡ç”Ÿä½ç½®çš„å€¼ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªæä¾›çš„å€¼éƒ½ä¼šé™„å¸¦ä¸€æ¡ä»ç›¸åº” Merkle æ ‘æ ¹åˆ°å¶å­çš„**Merkle è·¯å¾„**ï¼Œä»¥ä¾¿éªŒè¯è€…ç¡®è®¤è¿™äº›å€¼ç¡®å®åœ¨æ­¤å‰æ‰¿è¯ºçš„åºåˆ—ä¸­ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒStone å¯¹æŸ¥è¯¢åˆ†ä¸º**æ•°æ®æŸ¥è¯¢**å’Œ**å®Œæ•´æ€§æŸ¥è¯¢**ä¸¤ç±»ï¼šè‹¥æŸå±‚çš„æŸä¸ªå€¼å¯ä»¥ç”±å‰ä¸€å±‚çš„æŸ¥è¯¢å€¼è®¡ç®—æ¨å‡ºï¼ˆä¾‹å¦‚ \$p\_k(x)\$ å’Œ \$p\_k(-x)\$ å·²çŸ¥ï¼Œåˆ™ \$p\_{k+1}(x^2)\$æ— éœ€å•ç‹¬æä¾›ï¼‰ï¼Œåˆ™è¯¥å€¼ä¸ç›´æ¥ä½œä¸ºæ•°æ®å‘é€ï¼Œåªæä¾›å…¶éªŒè¯æ‰€éœ€çš„ Merkle è·¯å¾„ã€‚è¿™ç§ç­–ç•¥å‡å°‘äº†è¯æ˜ä¸­å†—ä½™æ•°æ®çš„å‘é€ã€‚ç»è¿‡ä¸Šè¿°æ­¥éª¤ï¼ŒStone Prover å°†æ„é€ å‡ºå®Œæ•´çš„è¯æ˜å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ï¼šæ‰€æœ‰é˜¶æ®µçš„ Merkle æ ¹æ‰¿è¯ºå€¼ã€æœ€åæ’å€¼å‡ºçš„ä½é˜¶å¤šé¡¹å¼ç³»æ•°ã€ä»¥åŠè‹¥å¹²æŸ¥è¯¢ä½ç½®å¯¹åº”çš„å¼€å€¼å’Œè®¤è¯è·¯å¾„ã€‚æ•´ä¸ªè¯æ˜å¯åºåˆ—åŒ–ä¸º JSON ç­‰æ ¼å¼ä¾›éªŒè¯è€…ä½¿ç”¨ã€‚

é€šè¿‡ä»¥ä¸Šæµç¨‹æ¦‚è§ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Stone Prover å†…éƒ¨æ¨¡å—çš„åä½œå…³ç³»ï¼š**AIR** æ¨¡å—å®šä¹‰çº¦æŸå¹¶å‚ä¸ç»„åˆå¤šé¡¹å¼è®¡ç®—ï¼Œ**ProverChannel** æ¨¡æ‹Ÿäº†éªŒè¯è€…äº¤äº’æä¾›éšæœºæŒ‘æˆ˜ï¼Œ**CompositionPolynomial** å°†å¤šé‡çº¦æŸå‹ç¼©è¿›å•ä¸€å¤šé¡¹å¼ï¼Œ**CommitmentScheme** é€šè¿‡ Merkle æ ‘å¯¹å¤šé¡¹å¼è¯„å€¼æ‰¿è¯ºå¹¶æ”¯æŒå¼€æ”¾æŸ¥è¯¢ï¼Œæœ€å **FRIProver** ä¿éšœäº†å¤šé¡¹å¼çš„ä½é˜¶æ€§è¯æ˜ã€‚ä¸‹é¢çš„å„èŠ‚å°†æ·±å…¥è®²è§£è¿™äº›æ¨¡å—çš„è®¾è®¡ä¸å®ç°ç»†èŠ‚ã€‚

### 2.2 Cairo CPU AIR æ¨¡å—

**AIRï¼ˆAlgebraic Intermediate Representationï¼‰** æ¨¡å—æ‰¿æ‹…å°† Cairo VM çš„æ‰§è¡Œè¯­ä¹‰è½¬æ¢ä¸ºä»£æ•°çº¦æŸçš„èŒè´£ã€‚åœ¨ Stone Prover ä¸­ï¼Œ`CpuAir` ç±»å®ç°äº† Cairo CPU çš„å…·ä½“ AIRï¼Œç”¨å¤šé¡¹å¼ç­‰å¼å½¢å¼å®šä¹‰äº†å¯„å­˜å™¨ã€å†…å­˜çš„è¿‡æ¸¡è§„åˆ™å’Œçº¦æŸæ¡ä»¶ã€‚ä½œä¸º `Air` æŠ½è±¡åŸºç±»çš„ä¸€ä¸ªå®ç°ï¼Œ`CpuAir` åŒ…å«å¦‚ä¸‹å…³é”®ä¿¡æ¯ï¼š

* **è½¨è¿¹ç»“æ„ä¸é•¿åº¦**ï¼š`CpuAir` çŸ¥é“ Cairo æ‰§è¡Œè½¨è¿¹çš„åŸºæœ¬ç»“æ„ï¼Œå¦‚æœ‰å¤šå°‘ä¸ªå¯„å­˜å™¨åˆ—ã€æ¯åˆ—å¯¹åº”ä½•ç§çŠ¶æ€é‡ï¼ˆç¨‹åºè®¡æ•°å™¨ã€æŒ‡ä»¤/opcodeã€æ“ä½œæ•°ã€å†…å­˜åœ°å€ç­‰ï¼‰ï¼Œä»¥åŠè½¨è¿¹æ­¥æ•° \$N=2^n\$ ç­‰ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å†³å®šäº† AIR å¤šé¡¹å¼ç³»ç»Ÿçš„ç»´åº¦å’Œå®šä¹‰åŸŸã€‚

* **çº¦æŸå¤šé¡¹å¼**ï¼š`CpuAir` å®šä¹‰äº†ä¸€ç»„å¤šé¡¹å¼çº¦æŸï¼Œç”¨äºéªŒè¯ç›¸é‚»ä¸¤æ­¥ï¼ˆä»¥åŠå†…å­˜å•å…ƒï¼‰çš„çŠ¶æ€å…³ç³»æ˜¯å¦åˆæ³•ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå¯„å­˜å™¨æ›´æ–°ã€å†…å­˜è¯»å†™ã€å†…ç½®æ“ä½œç»“æœç­‰ï¼Œæ¯ä¸€æ¡çº¦æŸå¯¹åº”ä¸€ä¸ªåœ¨æ‰€æœ‰è½¨è¿¹æ­¥ä¸Šåº”ä¸ºé›¶çš„å¤šé¡¹å¼å…³ç³»ã€‚`CpuAir` ä¼šå®ç°åŸºç±»æ‰€éœ€çš„æ¥å£æ–¹æ³•ï¼Œå¦‚ `ConstraintsEval(trace_point_values, random_challenges...)`ã€‚Stone åœ¨è®¡ç®—ç»„åˆå¤šé¡¹å¼æ—¶ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œå°†æŸä¸€æ­¥çš„æ‰€æœ‰ç›¸å…³è½¨è¿¹å€¼ä»£å…¥ï¼Œè®¡ç®—å‡ºå„çº¦æŸåœ¨è¯¥ç‚¹çš„å€¼å¹¶æŒ‰è¦æ±‚èšåˆã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼Œæ¯ä¸ªå…·ä½“ AIR å®ç°è´Ÿè´£**æ­£ç¡®åœ°æ±‡æ€»**å…¶æ‰€æœ‰çº¦æŸåœ¨ç»™å®šç‚¹çš„åŠ æƒå’Œï¼Œè¿™æ­£æ˜¯ç»„åˆå¤šé¡¹å¼è¯„å€¼çš„åŸºç¡€ã€‚å› æ­¤ï¼Œ`CpuAir` åœ¨å®ç° `ConstraintsEval` æ—¶ï¼Œä¼šå°† Cairo çš„å¤šä¸ªçº¦æŸå¤šé¡¹å¼æŒ‰ Stone é¢„å®šçš„æ–¹å¼ï¼ˆå¦‚ä¸åŒå¹‚æ¬¡çš„ Î±ï¼‰ç›¸åŠ ï¼Œè¿”å›å•ä¸ªç»„åˆçº¦æŸå€¼ã€‚

* **å…¬å…±è¾“å…¥å’Œè¾¹ç•Œæ¡ä»¶**ï¼šå¯¹äº Cairo ç¨‹åºéªŒè¯ï¼Œ`CpuAir` è¿˜å¤„ç†ä¸€äº›**è¾¹ç•Œçº¦æŸ**å’Œ**å…¬å…±è¾“å…¥**ç›¸å…³çš„é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œè½¨è¿¹çš„åˆå§‹çŠ¶æ€å¿…é¡»ç¬¦åˆç¨‹åºå…¬å¼€çš„è¾“å…¥ï¼ˆå¦‚ç¨‹åºå…¥å£åœ°å€ã€åˆå§‹å¯„å­˜å™¨å€¼ï¼‰ï¼Œå†…å­˜çš„æœ€ç»ˆçŠ¶å†µè¦æ»¡è¶³ Cairo è¯­ä¹‰ï¼ˆå¦‚æ‰€æœ‰å†…ç½®æ®µå¤§å°æ­£ç¡®ï¼‰ç­‰ã€‚Stone Prover å¹¶æ²¡æœ‰åœ¨éªŒè¯é˜¶æ®µè‡ªåŠ¨æ ¡éªŒæ‰€æœ‰è¿™äº›æ¡ä»¶ï¼Œå› æ­¤ `CpuAir` éœ€è¦ç¡®ä¿å°†å…¶ä¸­å…³é”®çš„ä¸å˜æ¡ä»¶çº³å…¥ AIR çº¦æŸæˆ–ç”±å¤–éƒ¨æ£€æŸ¥ã€‚æ­¤å¤–ï¼Œ`CpuAir` ä¼šå‚ä¸**Fiat-Shamirç§å­**çš„è®¡ç®—â€”â€”åœ¨åˆå§‹åŒ–è¯æ˜ä¿¡é“æ—¶ï¼Œå°† \$n\_steps\$ï¼ˆè½¨è¿¹é•¿åº¦ï¼‰ã€æ“ä½œè®¡æ•°ä¸Šä¸‹ç•Œï¼ˆå¦‚ rc\_min, rc\_maxï¼‰ä»¥åŠå…¬å…±å†…å­˜å†…å®¹å“ˆå¸Œç­‰ä¿¡æ¯é€å…¥åˆå§‹å“ˆå¸Œã€‚è¿™ä½¿å¾—è¯æ˜çš„éšæœºæŒ‘æˆ˜ä¸å…·ä½“è¢«è¯æ˜çš„ç¨‹åºå®ä¾‹ç»‘å®šï¼Œç¡®ä¿å®‰å…¨æ€§ã€‚

* **ä»£ç ç»„ç»‡**ï¼šStone Prover çš„æºç ä¸­ï¼ŒAIR éƒ¨åˆ†ä½äº `src/starkware/air/` ç­‰ç›®å½•ä¸‹ï¼Œ`CpuAir` ä½œä¸º Cairo AIR çš„å®ç°ç±»ã€‚ç±»ä¼¼åœ°è¿˜æœ‰ç”¨äºæµ‹è¯•çš„ç®€åŒ– AIRï¼ˆå¦‚ Fibonacci åºåˆ—çš„ `FibonacciAir`ï¼‰å®ç°ã€‚è¿™äº›ç±»éƒ½ç»§æ‰¿è‡ªç»Ÿä¸€çš„ `Air` æ¥å£ï¼Œç¡®ä¿å¯ä»¥è¢«ç»„åˆå¤šé¡¹å¼æ¨¡å—è°ƒç”¨ã€‚`CpuAir` åœ¨æ„é€ æ—¶ä¼šè¯»å–é…ç½®ï¼ˆä¾‹å¦‚æ‰©å±•åŸŸå¤§å°ã€éšæœºåŸŸç”Ÿæˆå…ƒç­‰ï¼‰å¹¶é¢„è®¡ç®—ä¸€äº›å¸¸é‡ï¼Œç”¨äºåŠ é€Ÿåç»­çº¦æŸè¯„ä¼°ã€‚

æ€»ä¹‹ï¼ŒAIR æ¨¡å—æ˜¯ Stone Prover çš„ç®—æœ¯ç”µè·¯å®šä¹‰éƒ¨åˆ†ã€‚`CpuAir` å°† Cairo VM çš„æ‰§è¡Œè§„åˆ™å°è£…æˆå¤šé¡¹å¼çº¦æŸï¼Œä¸ºåç»­ç»„åˆå¤šé¡¹å¼çš„ç”Ÿæˆå¥ å®šäº†åŸºç¡€ã€‚åœ¨ Stone æ¶æ„ä¸­ï¼ŒAIR æ¨¡å—ä¸ç»„åˆå¤šé¡¹å¼æ¨¡å—å…³ç³»ç´§å¯†ï¼šå‰è€…æä¾›åŸå­çº¦æŸè¯„ä¼°ï¼Œåè€…é€šè¿‡éšæœºçº¿æ€§ç»„åˆå°†å…¶æ±‡æ€»ï¼Œä»è€Œå®ç°å¯¹æ‰§è¡Œè½¨è¿¹æ­£ç¡®æ€§çš„"ä¸€æ¬¡æ€§"å¤šé¡¹å¼æ£€æµ‹ã€‚

## 2.3 éäº¤äº’è¯æ˜ä¿¡é“ï¼ˆProverChannelï¼‰

Stone Prover é‡‡ç”¨**éäº¤äº’é›¶çŸ¥è¯†**æ¨¡å¼ï¼Œé€šè¿‡ Fiat-Shamir è½¬æ¢æ¥æ¶ˆé™¤çœŸå®äº¤äº’ä¸­çš„éªŒè¯è€…ï¼Œ`ProverChannel` ç±»å³æ‰¿æ‹…æ¨¡æ‹ŸéªŒè¯è€…å‘é€éšæœºæŒ‘æˆ˜çš„åŠŸèƒ½ã€‚Stone çš„ä¿¡é“å®ç°è¢«ç§°ä¸º `NonInteractiveProverChannel`ï¼Œå…¶æ ¸å¿ƒæ˜¯ç»´æŠ¤ä¸€ä¸ª**Transcriptï¼ˆäº¤äº’è®°å½•ï¼‰**ï¼Œé€šè¿‡å¯†ç å­¦å“ˆå¸Œé“¾ç´¯ç§¯æ¥è‡ªè¯æ˜è€…çš„æ¶ˆæ¯ï¼Œå¹¶ä¼ªéšæœºåœ°äº§ç”ŸéªŒè¯è€…åº”æä¾›çš„æŒ‘æˆ˜ã€‚

**å·¥ä½œåŸç†**ï¼š`ProverChannel` æä¾›ä¸¤ä¸ªåŸºæœ¬æ“ä½œæ¥æ„å»º Fiat-Shamir è¿‡ç¨‹ï¼š

* `SendBytes(data)`: å°†æŒ‡å®šå­—èŠ‚ä¸²è¿½åŠ åˆ°å½“å‰ transcriptã€‚å½“è¯æ˜è€…è¦"å‘é€"æ‰¿è¯ºå€¼æˆ–å…¶ä»–æ•°æ®ç»™éªŒè¯è€…æ—¶ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä¼šå°†æ•°æ®æºå…¥å“ˆå¸ŒçŠ¶æ€ã€‚å¯¹äº Stone Proverï¼Œè¿™åŒ…æ‹¬æ¯æ¬¡ Merkle æ ¹æ‰¿è¯ºã€æœ€ç»ˆå¤šé¡¹å¼ç³»æ•°ã€ä»¥åŠå…¶å®ƒéœ€è¦è®©éªŒè¯è€…"çœ‹åˆ°"çš„å€¼ã€‚

* `ReceiveBytes(len)`: ä»å½“å‰ transcript æ¨å¯¼å‡ºä¼ªéšæœºçš„å­—èŠ‚ä¸²ï¼ˆé•¿åº¦ä¸ºå‚æ•° `len`ï¼‰ï¼Œæ¨¡æ‹Ÿä»éªŒè¯è€…æ¥æ”¶éšæœºæ€§ã€‚å†…éƒ¨å®ç°ä¸Šï¼Œè¿™åˆ©ç”¨å½“å‰å“ˆå¸ŒçŠ¶æ€å’Œä¸€ä¸ªå†…ç½®è®¡æ•°å™¨ç”Ÿæˆè¾“å‡ºã€‚Stone å°è£…äº†æ›´é«˜çº§çš„æ¥å£ï¼Œå¦‚ç›´æ¥æŠ½å–ä¸€ä¸ªåœºå…ƒç´ æˆ–ä¸€ä¸ªæ•´æ•°ï¼Œå…¶å®è´¨éƒ½æ˜¯è°ƒç”¨ `ReceiveBytes` è·å–è¶³å¤Ÿçš„éšæœºå­—èŠ‚å†è½¬æ¢ä¸ºç›¸åº”æ•°å€¼ã€‚

Stone å°†ä¸Šè¿°é€»è¾‘ä¸»è¦å®ç°åœ¨ `HashChain` ç±»ä¸­ï¼Œå¹¶åœ¨ `ProverChannel` ä¸­ç»„åˆä½¿ç”¨ã€‚`HashChain` ç»´æŠ¤ä»¥ä¸‹é‡è¦çŠ¶æ€ï¼š

* `hash`: å½“å‰çš„å“ˆå¸Œè®¡ç®—ä¸Šä¸‹æ–‡ï¼ˆä½¿ç”¨æŒ‡å®šå“ˆå¸Œå‡½æ•°ï¼Œå¦‚ Keccak256ï¼‰ã€‚
* `counter`: ä¸€ä¸ª64ä½è®¡æ•°å™¨ï¼Œç”¨äºè®°å½•å·²ç»äº§ç”Ÿçš„éšæœºå“ˆå¸Œå—æ•°é‡ã€‚æ¯æ¬¡éœ€è¦æ–°çš„éšæœºè¾“å‡ºæ—¶ï¼Œè®¡æ•°å™¨åŠ 1ï¼Œå¹¶ä¸å½“å‰å“ˆå¸Œdigestä¸€èµ·è®¡ç®—ä¸‹ä¸€ä¸ªè¾“å‡ºã€‚
* `spare_bytes`: ç¼“å­˜æœªç”¨å®Œçš„éšæœºå­—èŠ‚å—ã€‚å¦‚æœè¯·æ±‚éšæœºå­—èŠ‚é•¿åº¦éå“ˆå¸Œè¾“å‡ºå¤§å°çš„æ•´æ•°å€ï¼Œå¤šä½™å­—èŠ‚æš‚å­˜ä»¥ä¾›ä¸‹æ¬¡ä½¿ç”¨ã€‚

å½“è°ƒç”¨ `SendBytes(X)` æ—¶ï¼ŒStone é¦–å…ˆå–å½“å‰å“ˆå¸Œçš„digestä½œä¸º"å¤§ç§å­"Dï¼Œå°†å…¶è§†ä¸ºå¤§æ•´æ•°åŠ ä¸Šä¸€ä¸ªå¸¸æ•°å¢é‡ï¼Œç„¶åä¸å¾…å‘é€æ•°æ® X è¿æ¥ï¼Œé‡æ–°åˆå§‹åŒ–å“ˆå¸ŒçŠ¶æ€ã€‚è¿™ä¸ªè¿‡ç¨‹ç›¸å½“äº `hash_state = H( D + c || X )`ï¼Œå…¶ä¸­ \$c\$ æ˜¯å›ºå®šå¢é‡ã€‚å¦‚æ­¤ç¡®ä¿æ¯æ¬¡å‘é€æ“ä½œéƒ½ä¼šå½±å“åç»­æŒ‘æˆ˜çš„ä¸å¯é¢„æµ‹æ€§ã€‚è‡³äº `ReceiveBytes`ï¼ŒStone åˆ™ä¸æ–­å¯¹ (`current_digest || counter`) å–å“ˆå¸Œæ¥äº§ç”Ÿæ‰€éœ€é•¿åº¦çš„éšæœºæµã€‚

**å“ˆå¸Œé€‰æ‹©ä¸å®ç°**ï¼šStone ç¼ºçœé‡‡ç”¨ Keccak256 ä½œä¸º Fiat-Shamir ä¿¡é“çš„å“ˆå¸Œå‡½æ•°ï¼ˆè¾“å‡º256ä½ï¼‰ã€‚ä»£ç ä¸­ä¹Ÿæ”¯æŒ Pedersen å“ˆå¸Œã€Blake2s ç­‰ï¼Œé€šè¿‡æ¨¡æ¿å‚æ•°é…ç½®ã€‚åœ¨ Lambdaclass å¯¹ Stone çš„å…¼å®¹å®ç°ä¸­ï¼Œç”šè‡³æä¾›äº†åŒæ—¶æ”¯æŒå¤šç§å“ˆå¸Œçš„æ¨¡å¼ã€‚Stone çš„è®¾è®¡å…è®¸åœ¨ç¼–è¯‘æ—¶é€‰æ‹©å“ˆå¸Œç®—æ³•ï¼Œä½¿å¾— ProverChannel å¯ä»¥çµæ´»é€‚é…ä¸åŒå®‰å…¨è¦æ±‚æˆ–æ€§èƒ½è€ƒè™‘ã€‚

**æŒ‘æˆ˜æµç¨‹**ï¼šåœ¨Stoneçš„è¯æ˜ä¸»æµç¨‹ä¸­ï¼Œæ¯å½“éœ€è¦éªŒè¯è€…æä¾›éšæœºæŒ‘æˆ˜æ—¶ï¼ˆä¾‹å¦‚ç»„åˆå¤šé¡¹å¼ç³»æ•°Î±ï¼ŒOODSé‡‡æ ·ç‚¹Î²ç­‰ï¼‰ï¼ŒProver ä¼šå…ˆé€šè¿‡ `SendBytes` æŠŠç›¸å…³çš„ä¸Šä¸€æ­¥æ‰¿è¯ºå€¼åŠ å…¥ transcriptï¼Œç„¶åé©¬ä¸Šè°ƒç”¨ `ReceiveBytes` æ´¾ç”Ÿå‡ºæŒ‘æˆ˜ã€‚æ¯”å¦‚ï¼š"å‘é€"è½¨è¿¹ Merkle æ ¹åæ”¶åˆ° Î±ï¼Œ"å‘é€"ç»„åˆå¤šé¡¹å¼ Merkle æ ¹åæ”¶åˆ° Î²ï¼Œç­‰ç­‰ã€‚æ‰€æœ‰è¿™äº›äº¤äº’ä¼šè¢«è®°å½•åœ¨ Stone è¾“å‡ºçš„è¯æ˜æ–‡ä»¶ä¸­ï¼ˆå¦‚æœå¼€å¯æ—¥å¿—æ ‡å¿— `-generate_annotations`ï¼Œåˆ™ä¼šåˆ—å‡ºæ¯æ¬¡ P->V, V->P çš„äº¤äº’å†…å®¹ä»¥æ–¹ä¾¿è°ƒè¯•ï¼‰ã€‚

éœ€è¦æ³¨æ„ï¼ŒStone Prover çš„ä¿¡é“æ˜¯å•å‘çš„â€”â€”è¯æ˜è¿‡ç¨‹ä¸­åªæœ‰ Prover ä¸æ–­åœ°å‘ transcript æ·»åŠ æ•°æ®ï¼Œ`ProverChannel` å†äº§ç”ŸæŒ‘æˆ˜ã€‚å¹¶ä¸å­˜åœ¨çœŸæ­£çš„éªŒè¯è€…æ¶ˆæ¯ï¼Œä½†ä»é€»è¾‘ä¸Šç­‰ä»·äºéªŒè¯è€…çœ‹åˆ°äº†æ‰€æœ‰å‘é€çš„æ•°æ®åï¼Œä½¿ç”¨å…±äº«çš„å“ˆå¸Œå‡½æ•°äº§ç”Ÿäº†ç›¸åº”çš„éšæœºæ•°ã€‚è¿™ç§**éäº¤äº’è¯æ˜ä¿¡é“**ç¡®ä¿äº†åè®®çš„å®‰å…¨æ€§ï¼ˆåœ¨éšæœºé¢„è¨€æœºæ¨¡å‹ä¸‹ï¼‰ï¼Œå› ä¸ºæŒ‘æˆ˜å–å†³äºæ­¤å‰æ‰€æœ‰æ‰¿è¯ºï¼Œè¯æ˜è€…æ— æ³•é¢„æµ‹æŒ‘æˆ˜æ¥ä½œå¼Šã€‚

**éªŒè¯ç«¯å¯¹åº”**ï¼šStone ä¹Ÿå®ç°äº†å¯¹åº”çš„ `VerifierChannel`ï¼ˆéäº¤äº’éªŒè¯ä¿¡é“ï¼‰ï¼ŒVerifier ä¼šåœ¨éªŒè¯è¿‡ç¨‹ä¸­æ‰§è¡Œç›¸åŒçš„ SendBytes/ReceiveBytes åºåˆ—ï¼Œä»¥é‡ç°è¯æ˜è€…å½“åˆçœ‹åˆ°çš„æŒ‘æˆ˜åºåˆ—ã€‚åªè¦è¯æ˜æ–‡ä»¶ä¸­åŒ…å«äº†æ¯ä¸€æ­¥è¯¥å‘é€çš„å†…å®¹ï¼ŒéªŒè¯å™¨å°±èƒ½åŒæ­¥å¾—åˆ°ä¸€è‡´çš„éšæœºæ•°ï¼Œä»è€ŒéªŒè¯å„æ­¥è®¡ç®—ã€‚åœ¨Stoneä»£ç ä¸­ï¼ŒProverChannelå’ŒVerifierChannelå…±äº«å¤§éƒ¨åˆ†é€»è¾‘ï¼Œç¡®ä¿å“ˆå¸Œå’Œè®¡æ•°å™¨æ¨è¿›æ–¹å¼å®Œå…¨ä¸€è‡´ã€‚

æ€»ä¹‹ï¼Œ`ProverChannel` æ¨¡å—åœ¨ Stone æ¶æ„ä¸­æ‰®æ¼”äº†"éšæœºæ€§æä¾›è€…"å’Œ"åè®®è°ƒåº¦ä¸­ä»‹"çš„è§’è‰²ã€‚å®ƒè®©å„æ¨¡å—æ— éœ€å…³å¿ƒæŒ‘æˆ˜å¦‚ä½•äº§ç”Ÿï¼Œåªéœ€åœ¨é€‚å½“æ—¶æœºå‘é€æ•°æ®ã€æå–éšæœºæ•°ã€‚é€šè¿‡ ProverChannelï¼ŒStone å°†ä¸€ä¸ªäº¤äº’å¼çš„ STARK åè®®è½¬åŒ–ä¸ºäº†å¯é‡æ”¾ã€å¯éªŒè¯çš„éäº¤äº’è¯æ˜æµç¨‹ã€‚

## 2.4 ç»„åˆå¤šé¡¹å¼æ„å»º

**ç»„åˆå¤šé¡¹å¼ï¼ˆComposition Polynomialï¼‰** æ˜¯ Stone Prover ç®—æ³•çš„æ ¸å¿ƒç¯èŠ‚ä¹‹ä¸€ã€‚å®ƒé€šè¿‡å°†æ‰€æœ‰ AIR çº¦æŸæ··åˆè¿›å•ä¸€å¤šé¡¹å¼æ¥å®ç°"ä¸€æ¬¡éªŒè¯"å¤šä¸ªçº¦æŸçš„ç›®çš„ã€‚å…·ä½“æ¥è¯´ï¼Œç»™å®š AIR å®šä¹‰çš„\$m\$ä¸ªçº¦æŸå¤šé¡¹å¼\${f\_1(\cdot), f\_2(\cdot), \dots, f\_m(\cdot)}\$ï¼ŒStone Prover ä»ä¿¡é“è·å¾—éšæœºç³»æ•°ï¼ˆå¦‚æŒ‘æˆ˜ \$\alpha\$ï¼‰ï¼Œæ„é€ ç»„åˆå¤šé¡¹å¼ï¼š

$H(X) = f_1(X) + \alpha \cdot f_2(X) + \alpha^2 \cdot f_3(X) + \cdots + \alpha^{m-1} \cdot f_m(X).$

å¦‚æœè¢«è¯æ˜çš„è½¨è¿¹åˆæ³•ï¼Œåˆ™åœ¨æ•´ä¸ªåŸŸä¸Š\$H(X)\$åº”æ˜¯ä¸€ä¸ªä½é˜¶å¤šé¡¹å¼ï¼Œå¹¶ä¸”åœ¨éšæœºç‚¹\$z\$å¤„\$H(z)=0\$ï¼ˆç»“åˆOODSæ£€æŸ¥ï¼‰ã€‚ç»„åˆå¤šé¡¹å¼å°†å¤šé¡¹å¼çº¦æŸæ»¡è¶³æ€§é—®é¢˜å½’çº¦ä¸ºå•ä¸€å¤šé¡¹å¼çš„ä½é˜¶æ€§å’Œå–å€¼æ£€æŸ¥é—®é¢˜ï¼Œæ˜¯ STARK è¯æ˜ç®€æ´æ€§çš„æ¥æºä¹‹ä¸€ã€‚

Stone Prover ä¸­çš„ç»„åˆå¤šé¡¹å¼æ¨¡å—ç”±ä»¥ä¸‹ä¸»è¦ç±»ç»„æˆï¼š

* `CompositionPolynomial` æŠ½è±¡ç±»ï¼šå®šä¹‰äº†ç»„åˆå¤šé¡¹å¼å¯¹è±¡çš„æ¥å£ï¼ŒåŒ…æ‹¬è¯„ä¼°ã€æ’å€¼ç­‰æ“ä½œã€‚
* `CompositionPolynomialImpl` ç±»ï¼š`CompositionPolynomial` çš„å…·ä½“å®ç°ã€‚åœ¨Stoneçš„ä»£ç ä¸­ï¼Œå®ƒå¹¶æœªé‡‡ç”¨pimplæ‰‹æ³•ï¼Œè€Œæ˜¯ç›´æ¥ç»§æ‰¿å®ç°æ‰€æœ‰å¿…è¦åŠŸèƒ½ã€‚
* `CompositionOracleProver` ç±»ï¼šç»„åˆå¤šé¡¹å¼æ±‚å€¼å™¨ã€‚å®ƒæŒæœ‰ä¸€ä¸ª `CompositionPolynomial` å¯¹è±¡å®ä¾‹ï¼Œä»¥åŠå¯¹**è½¨è¿¹å¤šé¡¹å¼é›†åˆ**ã€**åŸŸå‚æ•°**ã€**ä¿¡é“**ç­‰çš„å¼•ç”¨ã€‚Oracleçš„ä½œç”¨æ˜¯åˆ©ç”¨è¿™äº›æ•°æ®æºæ¥è®¡ç®—ç»„åˆå¤šé¡¹å¼åœ¨ç‰¹å®šç‚¹æˆ–å…¨åŸŸä¸Šçš„å€¼ã€‚

Stone å¯¹ç»„åˆå¤šé¡¹å¼çš„è®¡ç®—ç­–ç•¥æ˜¯å°†ç¹é‡çš„çº¦æŸè¯„ä¼°è¿‡ç¨‹ä¸‹æ²‰åˆ° AIR å®ç°ä¸­ï¼Œè€Œç»„åˆå¤šé¡¹å¼ç±»æœ¬èº«è´Ÿè´£ç»„ç»‡å’Œå¹¶è¡ŒåŒ–è®¡ç®—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`CompositionPolynomialImpl` **ä¸ç›´æ¥å®ç°**å…·ä½“çš„çº¦æŸæ±‚å€¼é€»è¾‘ï¼›å®ƒæ›´å¤šåœ°å¤„ç†æ•°æ®åˆ†å‘å’Œç»“æœæ±‡æ€»ã€‚ä¾‹å¦‚ï¼Œå½“éœ€è¦è®¡ç®—\$H(X)\$åœ¨æŸä¸ªå­åŸŸä¸Šçš„å–å€¼æ—¶ï¼Œ`CompositionPolynomialImpl` ä¼šå‡†å¤‡å¥½è¯¥ç‚¹å¯¹åº”çš„æ‰€æœ‰è½¨è¿¹åˆ—å€¼ã€éšæœºæŒ‘æˆ˜ç­‰ï¼Œç„¶åè°ƒç”¨ç›¸åº”çš„ `Air::ConstraintsEval` æ–¹æ³•è·å–è¿™ä¸€ç‚¹å¤„ç»„åˆçº¦æŸçš„å€¼ã€‚å¦‚æ­¤ï¼Œæ¯ä¸ª AIR å­ç±»ï¼ˆå¦‚ `CpuAir`ï¼‰è‡ªè¡Œä¿è¯æŒ‰åè®®æ­£ç¡®åœ°ç»„åˆå…¶å†…éƒ¨å¤šä¸ªçº¦æŸå¹¶è¿”å›å•å€¼ï¼Œè¿™ç¡®ä¿äº†ç»„åˆå¤šé¡¹å¼è®¡ç®—çš„æ­£ç¡®æ€§ã€‚

**å¹¶è¡Œä¸åˆ†ç‰‡**ï¼šåœ¨å®é™…å®ç°ä¸­ï¼ŒStone é’ˆå¯¹å¤§è§„æ¨¡è½¨è¿¹æ”¯æŒå¹¶è¡Œè®¡ç®—ç»„åˆå¤šé¡¹å¼ã€‚åœ¨ `CompositionOracleProver::EvalComposition(n_tasks)` ä¸­ï¼Œè¯æ˜è€…å¯æŒ‡å®šå¹¶è¡Œä»»åŠ¡æ•°ï¼Œå°†æ‰©å±•åŸŸçš„è®¡ç®—åˆ’åˆ†ä¸º \$d\$ ä¸ªä½™å¼ç±»ï¼ˆcosetï¼‰å¹¶è¡Œå¤„ç†ã€‚æ¯ä¸ªä»»åŠ¡è´Ÿè´£ä¸€ä¸ª coset ä¸Šçš„å…¨éƒ¨ç‚¹ï¼šé¦–å…ˆè·å–è½¨è¿¹å¤šé¡¹å¼åœ¨è¯¥ coset ä¸Šçš„æ‰€æœ‰å€¼ï¼ˆå¦‚æœè¿™äº›å€¼åœ¨å‰ä¸€æ‰¿è¯ºé˜¶æ®µå·²è®¡ç®—å¹¶ç¼“å­˜ï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼‰ï¼›ç„¶åå¯¹äºcosetå†…çš„æ¯ä¸ªç‚¹ï¼Œè°ƒç”¨ç»„åˆå¤šé¡¹å¼å¯¹è±¡çš„ `EvalOnPoint` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å†…éƒ¨åˆä¼šè§¦å‘ `Air::ConstraintsEval` å¾—åˆ°æ­¤ç‚¹çš„ç»„åˆçº¦æŸå€¼ã€‚ç”±äºå„cosetè®¡ç®—å½¼æ­¤ç‹¬ç«‹ï¼ŒStone èƒ½å……åˆ†åˆ©ç”¨å¤šæ ¸æå‡ç»„åˆå¤šé¡¹å¼è¯„ä¼°é€Ÿåº¦ã€‚

**æ‹†åˆ†ä¸åº¦è°ƒæ•´**ï¼šä¸Šä¸€èŠ‚æåˆ°ï¼Œå½“ç»„åˆå¤šé¡¹å¼\$H(X)\$çš„ç†è®ºæœ€å¤§é˜¶è¶…è¿‡åŸºç¡€åŸŸå¤§å°ï¼ˆå³è½¨è¿¹é•¿åº¦\$N=2^n\$ï¼‰æ—¶ï¼Œéœ€è¦å°†å…¶æ‹†åˆ†ä¸º\$d\$ä¸ªå¤šé¡¹å¼éƒ¨åˆ† \$H\_0...H\_{d-1}\$ ä»¥é™ä½æ¯ä¸ªéƒ¨åˆ†çš„åº¦ã€‚Stone çš„å®ç°ä¸­ï¼Œè¿™ä¸€æ­¥é€šè¿‡å¯¹\$H\$çš„è¯„å€¼æ‰§è¡Œåˆ†ç»„å¤„ç†æ¥å®ç°ã€‚å…·ä½“è€Œè¨€ï¼Œå¦‚æœ \$d\$ æ˜¯2çš„å¹‚ï¼Œåˆ™å¯é€šè¿‡\$\log\_2 d\$è½®çš„éƒ¨åˆ†é€†FFTï¼Œå°†\$H\$åœ¨å¤§åŸŸä¸Šçš„è¯„å€¼è½¬åŒ–ä¸º\$d\$ä¸ªå­å¤šé¡¹å¼åœ¨å­åŸŸä¸Šçš„è¯„å€¼ï¼Œè€Œæ— é¡»å®Œå…¨æ±‚å‡º\$H\$çš„ç³»æ•°ã€‚è¿™æ ·ï¼Œè¯æ˜è€…å¾—åˆ°çš„ \$H\_i\$ï¼ˆ\$i=0,\dots,d-1\$ï¼‰æ¯ä¸€ä¸ªéƒ½å¯¹åº”è¾ƒä½é˜¶çš„å¤šé¡¹å¼ï¼Œå¯ä»¥å„è‡ªæ‰¿è¯ºã€‚éªŒè¯è€…åœ¨éªŒè¯æ—¶ä¹Ÿå¯åå‘ç»„åˆè¿™äº›éƒ¨åˆ†æ¥é‡æ„\$H\$åœ¨éšæœºç‚¹çš„å€¼éªŒè¯ä½é˜¶æ€§ã€‚ä¸€äº›ä¼˜åŒ–ç»†èŠ‚è¶…å‡ºäº†æœ¬ç« èŒƒå›´ï¼Œä½†å€¼å¾—ä¸€æ Stone **æ²¡æœ‰**å¯¹ç»„åˆå¤šé¡¹å¼å†åšé¢å¤–çš„ç»Ÿä¸€æœ¬è´¨åº¦è°ƒæ•´ï¼Œå³å‡è®¾å„çº¦æŸå¤šé¡¹å¼å·²é€šè¿‡å¼•å…¥è™šæ‹Ÿåˆ—ç­‰æ–¹å¼å¯¹é½äº†åº¦æ•°ã€‚

**æ·±åº¦ç»„åˆå¤šé¡¹å¼**ï¼šStone Prover é€šè¿‡ **æ·±åº¦ï¼ˆDEEPï¼‰ç»„åˆå¤šé¡¹å¼** å°† OODSï¼ˆOut-of-Domain Samplingï¼‰ æ£€æŸ¥èå…¥ç»„åˆå¤šé¡¹å¼æ¡†æ¶ã€‚å®ç°ä¸Šï¼Œåœ¨è¿›å…¥FRIä¹‹å‰ï¼ŒStone åˆ©ç”¨ `BoundaryAIR` ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„ç»„åˆå¤šé¡¹å¼ï¼ˆæ·±åº¦ç»„åˆï¼‰ï¼Œå…¶çº¦æŸç›¸å½“äºæ£€æŸ¥ \$H(z)\$ å‡å»å„é¡¹çº¦æŸæ®‹å€¼ä¹‹å’Œæ˜¯å¦ä¸º0ã€‚è¿™å®é™…ä¸Šå°†"\$H(z)=0\$"è¿™ä¸€æ¡ä»¶æ‰©å±•æˆä¸€ä¸ªéå¸ƒæ•´ä¸ªåŸŸçš„æ–°çº¦æŸé›†åˆï¼Œå†ç”¨éšæœºç³»æ•°æ··å…¥ä¸€ä¸ªç»¼åˆå¤šé¡¹å¼ä¸­ã€‚Stone ä½¿ç”¨ç›¸åŒçš„ `CompositionPolynomialImpl` æœºåˆ¶æ¥è®¡ç®—æ·±åº¦ç»„åˆå¤šé¡¹å¼ï¼Œåªæ˜¯åº•å±‚çš„ AIR å®ç°æ¢æˆäº† `BoundaryAIR`ï¼Œè€ŒæŒ‘æˆ˜ä¹Ÿæ¢æˆäº†æ–°çš„æ¥è‡ªä¿¡é“çš„éšæœºå€¼ï¼ˆå¸¸é‡Î²çš„æŸä¸ªæ´¾ç”Ÿï¼‰ã€‚æ·±åº¦ç»„åˆå¤šé¡¹å¼çš„ç»“æœéšåäº¤ç”±FRIè¯æ˜ä½é˜¶æ€§ã€‚åœ¨Stoneä»£ç çš„ `StarkProver::ProveStark` ä¸»æµç¨‹ä¸­ï¼Œæ·±åº¦ç»„åˆå¤šé¡¹å¼çš„æ±‚å€¼å™¨è¢«ç§°ä½œ `oods_composition_oracle`ã€‚

æ€»çš„æ¥è¯´ï¼Œç»„åˆå¤šé¡¹å¼æ¨¡å—å°† AIR æä¾›çš„å¤šé‡çº¦æŸ"å‹ç¼©"åˆ°ä¸€ä¸ªå¤šé¡¹å¼ä¸­ï¼Œä¸ºåç»­æ‰¿è¯ºå’Œä½åº¦è¯æ˜åˆ›é€ æ¡ä»¶ã€‚Stone Prover é€šè¿‡ç²¾å¿ƒçš„ç±»è®¾è®¡å’Œåˆ†å·¥ï¼Œä½¿ç»„åˆå¤šé¡¹å¼çš„è®¡ç®—æ—¢é«˜æ•ˆï¼ˆå¹¶è¡ŒåŒ–ã€éƒ¨åˆ†FFTä¼˜åŒ–ï¼‰åˆä¿è¯æ­£ç¡®æ€§ï¼ˆå°†å…³é”®é€»è¾‘å§”æ‰˜ç»™å„ AIR å®ç°ï¼‰ã€‚å¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œè¿™ä¸€æ¨¡å—å±•ç°äº† Stone å°†æ•°å­¦åè®®æ˜ å°„ä¸ºä»£ç çš„æ–¹å¼ï¼šåˆ©ç”¨é¢å‘å¯¹è±¡åˆ’åˆ†èŒè´£ï¼ŒAIR ç®¡çº¦æŸç»†èŠ‚ï¼ŒCompositionPolynomial ç®¡åè°ƒå’Œå¹¶è¡Œï¼Œä»è€Œå®ç°å¤æ‚è¯æ˜è¿‡ç¨‹çš„æ¨¡å—åŒ–ã€‚

## 2.5 å¤šé¡¹å¼æ‰¿è¯ºæœºåˆ¶

Stone Prover çš„**å¤šé¡¹å¼æ‰¿è¯ºæœºåˆ¶**è´Ÿè´£å¯¹å¤§è§„æ¨¡å¤šé¡¹å¼è¯„å€¼æä¾›åŠ å¯†æ‰¿è¯ºå’Œé«˜æ•ˆæ‰“å¼€ã€‚è¯¥æœºåˆ¶çš„å®ç°é‡‡ç”¨äº† **Merkle æ ‘** æ–¹æ¡ˆï¼šå°†å¤šé¡¹å¼åœ¨æŸç¦»æ•£åŸŸä¸Šçš„å–å€¼ä½œä¸ºå¶èŠ‚ç‚¹æ„é€  Merkle æ ‘ï¼Œæ ‘æ ¹å³ä¸ºæ‰¿è¯ºå€¼ã€‚éªŒè¯è€…é€šè¿‡å°‘é‡å¶å­æŸ¥è¯¢åŠå¯¹åº”Merkleè·¯å¾„å³å¯éªŒè¯æ‰¿è¯ºå¤šé¡¹å¼çš„æŸäº›è¯„å€¼ã€‚Stone åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†é’ˆå¯¹æ€§èƒ½å’Œå†…å­˜çš„è¯¸å¤šå·¥ç¨‹ä¼˜åŒ–ã€‚

**æ ¸å¿ƒç®—æ³•**ï¼šä»¥æäº¤è½¨è¿¹å¤šé¡¹å¼è¯„å€¼ä¸ºä¾‹ï¼Œå‡è®¾æœ‰ \$k\$ ä¸ªè½¨è¿¹åˆ—ï¼Œå¤šé¡¹å¼è¯„å€¼é•¿åº¦ä¸º \$M\$ï¼ˆé€šå¸¸ \$M\$ ä¸ºæ‰©å±•åŸŸå¤§å°ï¼‰ã€‚Stone é¦–å…ˆå°†æ•´ä¸ªè¯„å€¼è¡¨æŒ‰ç‰¹å®šé¡ºåº**æ’åˆ—**ï¼Œç„¶åå¯¹æ¯è¡Œè®¡ç®—å“ˆå¸Œï¼š

* **Bit-reversal æ’åº**ï¼šStone å¯¹è¯„å€¼è¡¨çš„è¡Œå’Œåˆ—é¡ºåºè¿›è¡Œäº†æ’åˆ—ä¼˜åŒ–ã€‚é¦–å…ˆï¼ŒæŒ‰ç…§ coset åºå·çš„äºŒè¿›åˆ¶åè½¬é¡ºåºé‡æ’æ‰€æœ‰è¡Œï¼›æ¥ç€ï¼Œå¯¹æ¯ä¸ª coset å†…éƒ¨ï¼Œå†æ¬¡æŒ‰äºŒè¿›åˆ¶åè½¬é¡ºåºé‡æ’è¡Œã€‚è¿™ä¸€æ’åˆ—ç¡®ä¿åœ¨æ„å»ºMerkleæ ‘æ—¶ï¼Œç›¸é‚»å¶å­åœ¨å†…å­˜ä¸Šçš„å±€éƒ¨æ€§æ›´å¥½ï¼ˆç›¸é‚»å¶å¯¹åº”è¿ç»­å†…å­˜å—ï¼‰ï¼Œä»è€Œæé«˜å“ˆå¸Œè®¡ç®—çš„ç¼“å­˜æ•ˆç‡ã€‚å¯¹äº\$2\$ä¸ªcosetçš„ç®€å•æƒ…å†µï¼Œç¬¬ä¸€æ¬¡é‡æ’ä¸ä¼šæ”¹å˜coseté¡ºåºï¼Œä½†ç¬¬äºŒæ¬¡é‡æ’ä¼šäº¤æ¢æ¯å¯¹ç›¸é‚»ç‚¹çš„é¡ºåºã€‚æ€»ä¹‹ï¼Œä½åè½¬æ’åˆ—è´¯ç©¿æ•´ä¸ªäºŒç»´è¡¨ï¼Œä½¿å…¶è¡Œç´¢å¼•åœ¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸Šç›¸é‚»çš„ä½ç¿»è½¬åå†ç›¸é‚»ï¼Œä»è€Œä¼˜åŒ–åç»­æ ‘æ„é€ æ€§èƒ½ã€‚

* **å¶èŠ‚ç‚¹æ„é€ **ï¼šæ’åˆ—å®Œæˆåï¼Œæ¯ä¸€è¡Œå¯¹åº”ä¸€ä¸ªå¶èŠ‚ç‚¹ã€‚Stone å°†è¯¥è¡Œæ‰€æœ‰åˆ—çš„å­—æ®µå…ƒç´ å€¼æŒ‰æ—¢å®šé¡ºåºè¿æ¥ï¼ˆæ³¨æ„ï¼šStone å­˜å‚¨åœºå…ƒç´ é‡‡ç”¨Montgomeryè¡¨ç¤ºï¼Œä¸”ä»¥little-endianå­—èŠ‚åºè¾“å‡ºï¼‰ï¼Œç„¶åå¯¹è¿æ¥å­—èŠ‚ä¸²è®¡ç®—å“ˆå¸Œï¼Œå¾—åˆ°å¶å­å“ˆå¸Œå€¼ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸¤åˆ—æ—¶ï¼Œå¶å“ˆå¸Œ = \$H(t\_0(i) \parallel t\_1(i))\$ï¼Œå…¶ä¸­ \$t\_j(i)\$ è¡¨ç¤ºç¬¬\$j\$åˆ—ç¬¬\$i\$è¡Œçš„åœºå…ƒç´ çš„å­—èŠ‚è¡¨ç¤ºã€‚å°†æ¯è¡Œå¤šä¸ªåˆ—å€¼åˆå¹¶è¿›å•ä¸ªå¶ï¼Œå¯ä»¥ç¡®ä¿å½“éªŒè¯è€…è¦æ±‚æ‰“å¼€æŸè¡Œæ—¶ï¼Œè¯æ˜è€…åŒæ—¶æä¾›è¯¥è¡Œä¸Šæ‰€æœ‰åˆ—çš„å€¼ï¼Œå¹¶å…±äº«ä¸€æ¡ Merkle è·¯å¾„ã€‚è¿™å‡å°‘äº†è¯æ˜å¤§å°å¹¶ç®€åŒ–éªŒè¯é€»è¾‘ã€‚

* **Merkle æ ‘ç”Ÿæˆ**ï¼šæœ‰äº† \$M\$ ä¸ªå¶å“ˆå¸Œåï¼ŒStone å¼€å§‹æ„å»º Merkle äºŒå‰æ ‘ï¼šæ¯ä¸¤ä¸ªç›¸é‚»å¶å­çš„å“ˆå¸Œè¿æ¥åå†å“ˆå¸Œï¼Œå½¢æˆçˆ¶èŠ‚ç‚¹å“ˆå¸Œï¼Œé‡å¤æ­¤è¿‡ç¨‹é€å±‚å‘ä¸Šï¼Œç›´åˆ°å¾—åˆ°å•ä¸€æ ¹å“ˆå¸Œã€‚è¿™éƒ¨åˆ†ä¸æ ‡å‡† Merkle ç®—æ³•ä¸€è‡´ã€‚Stone é’ˆå¯¹å…¸å‹ç¡¬ä»¶æ¶æ„åšäº†å®ç°ä¼˜åŒ–ï¼Œå¦‚æ‰¹é‡å“ˆå¸Œã€å†…å­˜å¯¹é½ç­‰ï¼Œä»¥æé«˜é€Ÿåº¦ã€‚æœ€ç»ˆäº§ç”Ÿçš„ Merkle æ ¹å°±æ˜¯å¯¹å…¨éƒ¨å¤šé¡¹å¼è¯„å€¼çš„**æ‰¿è¯º**ã€‚Prover å°†è¯¥æ ¹å€¼é€šè¿‡ `ProverChannel::SendBytes` é€šçŸ¥éªŒè¯è€…ï¼Œè¿›å…¥ä¸‹ä¸€è½®æŒ‘æˆ˜ã€‚

**ç±»è®¾è®¡**ï¼šStone åœ¨ä»£ç ä¸­ä»¥ `TableProver` å’Œ `CommitmentSchemeProver` æŠ½è±¡å°è£…äº†æ‰¿è¯ºé€»è¾‘ï¼š

* `TableProver` æŠ½è±¡ç±»ï¼šè¡¨ç¤ºä¸€ä¸ªäºŒç»´æ•°ç»„ï¼ˆè¡¨æ ¼ï¼‰çš„æ‰¿è¯º/æ‰“å¼€æ¥å£ã€‚å…¶å®ç°ç±» `TableProverImpl` å°è£…äº†å…·ä½“æäº¤å’Œæ‰“å¼€æ“ä½œï¼Œå¹¶ç»´æŠ¤ä¸ä¿¡é“çš„å…³è”ï¼ˆä»¥ä¾¿æäº¤åç«‹å³å‘é€ Merkle æ ¹ï¼‰ã€‚`TableProver` æä¾›æ–¹æ³•å¦‚ `Commit()` æäº¤è¡¨æ•°æ®ï¼Œ`Open(row_indices)` æ‰“å¼€æŒ‡å®šè¡Œçš„å€¼å¹¶æä¾›è¯æ˜è·¯å¾„ç­‰ã€‚

* `CommitmentSchemeProver` ç±»ï¼šè¿™æ˜¯æ‰§è¡Œå®é™… Merkle æ ‘ç®—æ³•çš„åº•å±‚ç±»ã€‚`TableProverImpl::Commit` æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨å…¶ `commitment_scheme_` æˆå‘˜ï¼ˆç±»å‹ä¸º `CommitmentSchemeProver`ï¼‰çš„ `Commit` å®ç°æ¥å¤„ç†å“ˆå¸Œè®¡ç®—ã€‚å› æ­¤å¯ä»¥å°† `CommitmentSchemeProver` çœ‹ä½œç­–ç•¥ç±»ï¼Œä¸“æ³¨äº**å¦‚ä½•å¯¹ç»™å®šçš„æ•°æ®ç”Ÿæˆæ‰¿è¯º**ã€‚

* **æ„å»ºä¸è£…é¥°å™¨**ï¼šStone è€ƒè™‘åˆ°ä¸åŒåœºæ™¯å¯¹æ‰¿è¯ºçš„éœ€æ±‚ï¼Œæœ‰ä¸€å¥—å·¥å‚/è£…é¥°å™¨æœºåˆ¶æ¥å®ä¾‹åŒ–é€‚å½“çš„ CommitmentSchemeã€‚æåˆ°ï¼Œæœ‰ä¸€ä¸ªæ‰¿è¯ºæ–¹æ¡ˆæ„å»ºå™¨ä¼šäº¤æ›¿åµŒå¥— `PackagingCommitmentSchemeProver` å’Œ `CachingCommitmentSchemeProver` ç­‰è£…é¥°å™¨ã€‚å…¶ä¸­ï¼š

  * `PackagingCommitmentSchemeProver` å†…å«ä¸€ä¸ªå®é™…çš„æ‰¿è¯ºæ–¹æ¡ˆå®ç°ï¼Œä½†ä¼šæŠŠè¾“å…¥æ•°æ®åˆ†æˆè‹¥å¹²**åŒ…**ï¼ˆsegmentï¼‰å†äº¤ç»™å†…éƒ¨æ–¹æ¡ˆå¤„ç†ã€‚
  * `CachingCommitmentSchemeProver` åˆ™è´Ÿè´£**ç¼“å­˜**ç”Ÿæˆçš„ Merkle æ ‘ã€‚å¦‚æœå¼€å¯ç¼“å­˜ï¼Œè¯æ˜è€…åœ¨åç»­ open æŸ¥è¯¢æ—¶æ— éœ€é‡æ–°è®¡ç®—Merkleè·¯å¾„ï¼Œæé«˜éªŒè¯æ•ˆç‡ï¼›è‹¥å†…å­˜æœ‰é™äº¦å¯é€‰æ‹©ä¸ç¼“å­˜ï¼Œæ¯æ¬¡æŸ¥è¯¢æ—¶å†è®¡ç®—ã€‚

* **æ®µï¼ˆSegmentï¼‰æ”¯æŒ**ï¼šæŒ‡å‡ºï¼Œå½“å¤šé¡¹å¼è¯„å€¼è¡¨éå¸¸å¤§ï¼ˆä¾‹å¦‚å†…å­˜è£…ä¸ä¸‹æ‰€æœ‰LDEæ•°æ®ï¼‰æ—¶ï¼Œå¯ä»¥å°†å…¶æŒ‰è¡Œè¿ç»­åˆ‡åˆ†ä¸ºè‹¥å¹²æ®µï¼Œæ¯æ®µåˆ†åˆ«æ„å»ºä¸€æ£µå­ Merkle æ ‘ã€‚ç„¶åï¼Œå†å°†è¿™äº›å­æ ‘çš„æ ¹å“ˆå¸Œä½œä¸ºå¶èŠ‚ç‚¹æ„å»ºä¸€ä¸ªé¡¶å±‚ Merkle æ ‘æ±‡æ€»ã€‚è¿™ç§ä¸¤çº§æ ‘ç»“æ„ç›¸å½“äºæŠŠæ•°æ®æ‰“åŒ…ï¼Œæ¯åŒ…å¤§å°é€‚é…å†…å­˜ã€‚ä¸€æ–¹é¢ï¼ŒéªŒè¯è€…æœ€ç»ˆæ‹¿åˆ°çš„ä»æ˜¯ä¸€ä¸ªæ€»çš„æ ¹æ‰¿è¯ºï¼›å¦ä¸€æ–¹é¢ï¼Œè¯æ˜è€…åœ¨éœ€è¦æ‰“å¼€æŸè¡Œæ—¶ï¼Œå¯ä»¥æ®è¡Œå·ç›´æ¥å®šä½æ‰€å±æ®µï¼Œä»ç¼“å­˜æˆ–ç£ç›˜è½½å…¥è¯¥æ®µçš„æ•°æ®æˆ–Merkleå­æ ‘è®¡ç®—è®¤è¯è·¯å¾„ã€‚Stone é€šè¿‡ `PackagingCommitmentSchemeProver` å®ç°äº†è¿™ä¸€æŒ‰åŒ…æ‰¿è¯ºçš„é€»è¾‘ã€‚

**æ‰“å¼€æŸ¥è¯¢**ï¼šå½“éªŒè¯è€…è¦æ±‚æ‰“å¼€æŸå‡ ä¸ªè¡Œï¼ˆç”±ä¹‹å‰æŒ‘æˆ˜éšæœºç¡®å®šï¼‰æ—¶ï¼ŒStone çš„ `TableProverImpl::Open` ä¼šï¼š

1. ç¡®è®¤æ‰€éœ€çš„æ•°æ®ï¼ˆè¡Œï¼‰æ‰€åœ¨æ®µå·²ç»è®¡ç®—è¿‡ Merkle æ ‘ï¼Œè‹¥ç¼“å­˜å¯ç”¨åˆ™ç›´æ¥è¯»å–ï¼Œå¦åˆ™è§¦å‘è®¡ç®—ã€‚
2. æ”¶é›†è¯¥è¡Œåœ¨è¡¨ä¸­çš„æ‰€æœ‰åˆ—å€¼ï¼Œå°†å®ƒä»¬è¾“å‡ºã€‚è¿™äº›å€¼å¯¹åº”å½“åˆå¶å­å“ˆå¸Œçš„è¾“å…¥ï¼ŒéªŒè¯è€…å¯ç›´æ¥å¾—åˆ°åŸå§‹å­—æ®µå…ƒç´ ã€‚
3. æä¾›ä»è¯¥å¶åˆ°æ ¹çš„è®¤è¯è·¯å¾„ï¼šè¿™æ˜¯ä¸€ä¸ªç”±ç›¸é‚»å…„å¼Ÿå“ˆå¸Œç»„æˆçš„åˆ—è¡¨ï¼Œé•¿åº¦ä¸ºæ ‘é«˜ã€‚è‹¥ä½¿ç”¨åˆ†æ®µï¼Œä¸¤çº§æ ‘éƒ½è¦æä¾›è·¯å¾„ï¼ˆå…ˆæ®µå†…å­æ ‘è·¯å¾„ï¼Œå†é¡¶å±‚æ ‘è·¯å¾„ï¼‰ã€‚éªŒè¯è€…æ®æ­¤å¯é‡ç®—å¹¶æ¯”å¯¹æ ¹æ‰¿è¯ºã€‚

Stone é‡‡ç”¨çš„ Merkle æ‰¿è¯ºæ–¹æ¡ˆå…·æœ‰**é€æ˜**å’Œ**å¯å¹¶è¡Œ**çš„ç‰¹ç‚¹ï¼Œæ²¡æœ‰å¯ä¿¡è®¾ç½®ä¸”å“ˆå¸Œè®¡ç®—æ˜“äºå¹¶è¡Œ/æµæ°´çº¿å¤„ç†ï¼Œéå¸¸é€‚åˆ STARK è¿™ç§éœ€è¦å¤„ç†å·¨å¤§æ•°æ®çš„åœºæ™¯ã€‚é€šè¿‡ `CommitmentSchemeProver` çš„æŠ½è±¡ï¼Œå¼€å‘è€…å¯ä»¥çœ‹å‡º Stone æ¡†æ¶å¯¹**çµæ´»æ€§**çš„è€ƒè™‘ï¼šå¯æ’æ‹”ä¸åŒå“ˆå¸Œç®—æ³•ï¼Œä¸åŒæ‰“åŒ…ç­–ç•¥ï¼Œç”šè‡³æ•´ä¸ªæ‰¿è¯ºæ–¹æ¡ˆï¼ˆè‹¥æ—¥åé‡‡ç”¨PCSç­‰å…¶å®ƒå¤šé¡¹å¼æ‰¿è¯ºä¹Ÿå¯é€‚é…ï¼‰ã€‚å¯¹äºç†Ÿæ‚‰ Cairo/STARK çš„å·¥ç¨‹å¸ˆè€Œè¨€ï¼Œè¿™ä¸€æ¨¡å—æä¾›äº†å¤§é‡å¯å¤ç”¨çš„ç»„ä»¶ï¼Œç”¨äºæ„å»ºè‡ªå®šä¹‰çš„æ‰¿è¯ºå’ŒæŸ¥è¯¢æ–¹æ¡ˆã€‚

## 2.6 FRI ä½åº¦è¯æ˜è¿‡ç¨‹

**FRI**ï¼ˆFast Reed-Solomon Interactive Oracle Proof of Proximityï¼‰æ¨¡å—æ˜¯ Stone Prover ä¿è¯å¤šé¡¹å¼ä½é˜¶æ€§çš„æœ€åå…³é”®ç»„æˆã€‚å®ƒé€šè¿‡å¤šè½®äº¤äº’ï¼ˆåœ¨éäº¤äº’æ¨¡å¼ä¸‹é€šè¿‡æŒ‘æˆ˜æ¨¡æ‹Ÿï¼‰ç¼©å°å¤šé¡¹å¼è¯„å€¼é›†åˆè§„æ¨¡ï¼Œå¹¶æœ€ç»ˆä»¥å¤šé¡¹å¼æ’å€¼éªŒè¯ï¼Œä»æ¦‚ç‡ä¸Šè¯æ˜åŸå¤šé¡¹å¼åº¦æ•°ä½äºç»™å®šä¸Šé™ã€‚

Stone Prover çš„ FRI å®ç°åœ¨æ¶æ„ä¸ŠåŒ…å«ä»¥ä¸‹è¦ç´ ï¼š

* **FRI å±‚ç”Ÿæˆ**ï¼š`FriProver` æ ¹æ®åˆå§‹å¾…æµ‹å¤šé¡¹å¼çš„è¯„å€¼ï¼ˆå¦‚æ·±åº¦ç»„åˆå¤šé¡¹å¼åœ¨LDEä¸Šçš„å–å€¼ï¼‰æ„é€ ç¬¬ä¸€å±‚ï¼Œç„¶åæŒç»­è¿›è¡Œ**æŠ˜å å˜æ¢**äº§ç”Ÿåç»­å±‚ã€‚æè¿°äº† Stone ä½¿ç”¨ `FriFolder` å®Œæˆå•å±‚æŠ˜å ï¼šå®ƒå°†å‰ä¸€å±‚è¯„å€¼æ•°ç»„æŒ‰é¢„å®šè§„åˆ™ä¸¤ä¸¤é…å¯¹ï¼Œè®¡ç®—ä¸€ä¸ªæ–°æ•°ç»„ä½œä¸ºä¸‹ä¸€å±‚è¯„å€¼ã€‚å…¶ä¸­å¸¸è§çš„è§„åˆ™æ˜¯ï¼šç»™å®šä¸Šä¸€å±‚å¤šé¡¹å¼\$p\_k(X)\$çš„è¯„å€¼ï¼Œå½“è®¾è®¡é€‰æ‹©æŠŠåŸŸå¤§å°å‡åŠæ—¶ï¼Œå¯ä»¤ \$p\_{k+1}(X) = \frac{1}{2}(p\_k(X) + p\_k(\omega \cdot X))\$ æˆ–ç±»ä¼¼çº¿æ€§ç»„åˆã€‚è¿™ç§æ“ä½œç­‰æ•ˆäºå°†å¤šé¡¹å¼çš„åº¦æ•°ä¸Šç•Œå‡åŠã€‚Stone çš„ `FriFolderBase` ç±»æä¾›äº†æŠ½è±¡æ¥å£ï¼Œä½¿ä¸åŒæŠ˜å ç­–ç•¥ï¼ˆä¾‹å¦‚å¯ä»¥å¼•å…¥éšæœºçº¿æ€§ç³»æ•°çš„æŠ˜å ï¼‰å¯ä»¥é€šè¿‡ç»§æ‰¿å®ç°ã€‚æåˆ°ï¼ŒFRI åè®®å…è®¸é€‰æ‹©æ€§åœ°å¯¹å¹¶éæ¯ä¸€å±‚éƒ½æ‰¿è¯ºï¼Œæ¯”å¦‚å¯ä»¥æ¯éš”å‡ å±‚æ‰ Merkle æäº¤ä¸€æ¬¡ç»“æœï¼›Stone æ”¯æŒé…ç½®ä¸€ä¸ª"FRIæ­¥é•¿å‘é‡"ï¼ˆcommit every few layersï¼‰æ¥è°ƒæ•´æŠ˜å å’Œæ‰¿è¯ºé¢‘ç‡ã€‚ç„¶è€Œï¼ŒStone å¼€å‘è€…å»ºè®®ä¸€èˆ¬æ¯2-3å±‚æäº¤ä¸€æ¬¡å³å¯ï¼Œè¿‡äºçµæ´»çš„æ­¥é•¿ä¼šå¢åŠ å®ç°å¤æ‚æ€§ä¸”æ”¶ç›Šä¸æ˜æ˜¾ã€‚

* **éšæœºæŒ‘æˆ˜ä¸å–æ ·**ï¼šç»å…¸ FRI æ˜¯ä¸€ä¸ªäº¤äº’åè®®ï¼šåœ¨æ¯è½®æŠ˜å åï¼ŒéªŒè¯è€…ä¼šå‘é€æ–°éšæœºæŒ‘æˆ˜æ¥å†³å®šä¸‹ä¸€è½®å–æ ·çš„ä½ç½®ã€‚ä½†Stoneé‡‡ç”¨çš„æ˜¯æ”¹è¿›çš„**æ‰¹é‡æŸ¥è¯¢FRI**ï¼ˆMulti-round, single-challengeï¼‰ï¼šåœ¨éäº¤äº’æ¨¡å¼ä¸­ï¼Œé€šå¸¸åªéœ€ä¸€ä¸ªå…¨å±€éšæœºç§å­å†³å®šæœ€ç»ˆéœ€è¦æŸ¥è¯¢çš„ä½ç½®ï¼Œç„¶åè¿™äº›æŸ¥è¯¢ç”±åº•å‘ä¸Šæ˜ å°„åˆ°å„å±‚çš„ä½ç½®å¯¹ã€‚è¿™æ„å‘³ç€Stoneåœ¨FRIå¼€å§‹æ—¶ï¼ˆæˆ–è€…æ‰€æœ‰æ‰¿è¯ºå®Œæˆåï¼‰ç»Ÿä¸€ç”Ÿæˆäº†ä¸€æ‰¹éšæœºæŸ¥è¯¢ç´¢å¼•ï¼Œè€Œéæ¯å±‚é‡æ–°æŠ½æ ·ã€‚Stone Prover ä½¿ç”¨ä¿¡é“æœºåˆ¶ï¼Œé€šå¸¸ä¼šåœ¨æäº¤æœ€åä¸€å±‚æˆ–æä¾›æœ€ç»ˆå¤šé¡¹å¼ç³»æ•°åï¼Œè°ƒç”¨ `ReceiveBytes` ä¸€æ¬¡äº§ç”Ÿæ‰€éœ€çš„éšæœºæŸ¥è¯¢ç´¢å¼•é›†åˆã€‚ç”±äºStoneè¯æ˜è¾“å‡ºæ˜¯æ•´ä½“åºåˆ—åŒ–çš„ï¼Œå…¶ä¸­è‡ªç„¶åŒ…å«äº†è¿™äº›æŸ¥è¯¢ä»¥åŠå¯¹åº”è¯æ˜æ•°æ®ï¼Œæ‰€ä»¥éªŒè¯è€…èƒ½æ®ç›¸åŒè¿‡ç¨‹é‡ç°æŸ¥è¯¢ç´¢å¼•ã€‚

* **Merkle æ‰¿è¯ºä¸è·¯å¾„**ï¼šFRI æ¯ä¸€å±‚çš„è¯„å€¼æ•°ç»„ Stone éƒ½é€šè¿‡Merkleæ ‘æ‰¿è¯ºï¼ˆæˆ–è€…æŒ‰é…ç½®æ¯å‡ å±‚æ‰¿è¯ºä¸€æ¬¡ï¼‰ã€‚è¿™äº› Merkle æ ¹å’Œè·¯å¾„çš„å¤„ç†ä¸ä¹‹å‰çš„è½¨è¿¹ã€ç»„åˆå¤šé¡¹å¼æ‰¿è¯ºå¹¶æ— æœ¬è´¨åŒºåˆ«ã€‚å› æ­¤ï¼Œå¯ä»¥é‡ç”¨å‰è¿° `CommitmentSchemeProver` æœºåˆ¶å¯¹æ¯å±‚è¾“å‡ºè¿›è¡Œæ‰¿è¯ºã€‚äº‹å®ä¸Šï¼ŒStone çš„ FRI å®ç°å°†æ¯ä¸€å±‚è§†ä¸ºä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼ˆåªæœ‰ä¸€åˆ—ï¼‰ï¼Œå› æ­¤æ„é€  Merkle æ ‘å¶æ—¶æ¯ä¸ªå¶å“ˆå¸Œåªæ˜¯å•ä¸ªè¯„å€¼çš„å“ˆå¸Œï¼ˆæ²¡æœ‰å¤šåˆ—ä¸²è”çš„é—®é¢˜ï¼‰ã€‚ä¸ºå‡å°‘è¯æ˜å¤§å°ï¼ŒStone å°†**æˆå¯¹æŠ˜å **å’Œ**è·¯å¾„ä¼˜åŒ–**ç›¸ç»“åˆï¼šæåˆ°ï¼Œå¦‚æœéªŒè¯è€…éœ€è¦æ£€æŸ¥æŸä¸€å±‚ä¸¤ä¸ªç›¸å…³ç‚¹ \$x, -x\$ çš„å€¼ï¼Œè¿™ä¸¤ä¸ªå€¼é€šå¸¸ä½äºåŒä¸€Merkleçˆ¶èŠ‚ç‚¹çš„å¶å¯¹é‡Œï¼Œå¯ä»¥é€šè¿‡ä¸€æ¬¡è·¯å¾„è®¤è¯è¦†ç›–ï¼ˆStone ç¡®ä¿æŠ˜å é€‰æ‹©ä½¿æŸ¥è¯¢ç‚¹æˆå¯¹å‡ºç°åœ¨æ ‘ç»“æ„ä¸­ï¼‰ã€‚å¹¶ä¸”ï¼Œç”±äº \$p\_{k+1}(x^2)\$ å¯ä»¥ç”±å·²çŸ¥çš„ \$p\_k(x)\$ å’Œ \$p\_k(-x)\$ è®¡ç®—å¾—åˆ°ï¼ŒStone å°†è¿™ç±»å€¼æ ‡è®°ä¸º**å®Œæ•´æ€§æŸ¥è¯¢**ï¼Œè¯æ˜ä¸­ä¸ç›´æ¥ç»™å‡ºå…¶æ•°å€¼ã€‚éªŒè¯è€…åœ¨æ£€æŸ¥æ—¶ï¼Œä¼šè‡ªè¡Œè®¡ç®—æœŸæœ›çš„ \$p\_{k+1}(x^2)\$ï¼Œç„¶åå¯¹æ¯”å®ƒçš„å“ˆå¸Œæ˜¯å¦åŒ¹é…æ¥è‡ªè¯æ˜çš„ Merkle è·¯å¾„èŠ‚ç‚¹å“ˆå¸Œã€‚å¦‚æœåŒ¹é…ä¸ä¸Šåˆ™è¯´æ˜è¯æ˜è€…æä¾›çš„å‰ä¸€å±‚å€¼ä¸ä¸€è‡´ã€‚è¿™æ ·åšçœå»äº†å‘é€ \$p\_{k+1}(x^2)\$ æœ¬èº«çš„å¼€é”€ï¼Œåœ¨ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶ç¼©å‡äº†è¯æ˜æ•°æ®é‡ã€‚

* **ç»ˆæ­¢ä¸å¤šé¡¹å¼é‡æ„**ï¼šFRI å¤šè½®æŠ˜å çš„ç›®æ ‡æ˜¯å°†å¤šé¡¹å¼è§„æ¨¡é™è‡³å¾ˆå°ï¼Œå†ç›´æ¥éªŒè¯"ä½é˜¶æ€§"ã€‚Stone è®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼Œå½“æŠ˜å åçš„è¯„å€¼æ•°é‡å°äºè¯¥é˜ˆå€¼ï¼ˆå¦‚ 16 æˆ– 32ï¼‰æ—¶ï¼Œå°±åœæ­¢è¿›ä¸€æ­¥æŠ˜å ã€‚æ­¤æ—¶å‡è®¾è¿˜æœ‰æœ€åä¸€å±‚è¯„å€¼æ•°ç»„ï¼ˆé•¿åº¦\$r\$ï¼‰ã€‚Stone Proverå¯¹è¿™\$r\$ä¸ªç‚¹æ‰§è¡Œå¤šé¡¹å¼æ’å€¼ï¼Œç›´æ¥è®¡ç®—å‡ºä¸€ä¸ªæ˜¾å¼çš„\$(r-1)\$æ¬¡å¤šé¡¹å¼\$q(X)\$ï¼Œå¹¶å°†\$q(X)\$çš„ç³»æ•°ä½œä¸ºè¯æ˜çš„ä¸€éƒ¨åˆ†æä¾›ç»™éªŒè¯è€…ã€‚éªŒè¯è€…å¯ä»¥è‡ªè¡Œåœ¨è¿™äº›ç³»æ•°ä¸Šåšä½é˜¶æ€§æ£€æŸ¥ï¼ˆæ˜¾ç„¶\$q(X)\$åº¦ä¸º\$r-1\$ï¼‰å¹¶åˆ©ç”¨å®ƒé¢„æµ‹æ›´é«˜å±‚çš„è¯„å€¼ç”¨äºæ¯”å¯¹ã€‚æ¯”å¦‚ï¼ŒéªŒè¯è€…å¯ä»¥ç”¨\$q(X)\$è®¡ç®—è‹¥å¹²éšæœºç‚¹å¤„çš„å€¼å¹¶ä¸å‰ä¸€å±‚Merklizedçš„å€¼æ ¸å¯¹ï¼Œä»¥ç¡®è®¤æŠ˜å æ­£ç¡®ã€‚Stone é€‰æ‹©æå‰æ’å€¼è€Œéä¸€ç›´æŠ˜å åˆ°åªå‰©1ä¸ªç‚¹ï¼Œæ˜¯å› ä¸ºå‘é€ä¸€ä¸ª\$(r-1)\$åº¦å¤šé¡¹å¼ï¼ˆå³\$r\$ä¸ªåœºå…ƒç´ ï¼‰å¾€å¾€æ¯”ç»§ç»­å‘é€å¤šè½®çš„Merkeè·¯å¾„æ›´èŠ‚çœç©ºé—´ï¼ŒåŒæ—¶é™ä½éªŒè¯è®¡ç®—é‡ã€‚åœ¨å®é™…è¯æ˜æ–‡ä»¶ä¸­ï¼Œè¿™äº›ç³»æ•°é€šå¸¸è¢«ç§°ä½œ"FRIç»ˆæ­¢å¤šé¡¹å¼ç³»æ•°"ï¼ŒéªŒè¯è€…ä¼šä½¿ç”¨å®ƒä»¬é‡å»ºæœ€åå‡ è½®çš„å€¼ã€‚

é€šè¿‡ä»¥ä¸Šè¿‡ç¨‹ï¼ŒStone çš„ FRI æ¨¡å—å®Œæˆäº†å¯¹æ·±åº¦ç»„åˆå¤šé¡¹å¼ä½é˜¶æ€§çš„è¯æ˜ã€‚æ•´ä½“è€Œè¨€ï¼ŒFRI æ¨¡å—ä¸æ‰¿è¯ºæ¨¡å—ã€ä¿¡é“æ¨¡å—å…±åŒå®ç°äº† STARK åè®®çš„ååŠéƒ¨åˆ†ï¼šç¡®ä¿ç»è¿‡çº¦æŸç»„åˆçš„ç›®æ ‡å¤šé¡¹å¼ç¡®å®æ˜¯ä½é˜¶ä¸”æ»¡è¶³ç‰¹å®šç‚¹çš„å€¼æ¡ä»¶ã€‚Stone FRI å®ç°çš„ä»£ç æ•£å¸ƒåœ¨ `starkware/fri/` ç›®å½•ä¸‹ï¼ŒåŒ…æ‹¬ `fri_prover.h/cpp`, `fri_folder.h/cpp` ç­‰ã€‚åœ¨é˜…è¯»æºç æ—¶å¯ä»¥çœ‹åˆ°ï¼ŒFRI éƒ¨åˆ†å¤§é‡ä½¿ç”¨äº†æ¨¡æ¿å’Œæ³›å‹ï¼Œä»¥æ”¯æŒä¸åŒçš„åœºå¤§å°ã€æŠ˜å ç­–ç•¥å’Œå“ˆå¸Œå‡½æ•°ã€‚å…¶ä¸­è®¸å¤šç»†èŠ‚å±äºæ€§èƒ½ä¼˜åŒ–èŒƒç•´ï¼Œä½†å…¶æ¶æ„æ¸…æ™°åœ°è¡¨è¾¾äº†ç®—æ³•æ­¥éª¤ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒStone çš„ FRI å®ç°å±•ç¤ºäº†å¦‚ä½•å°†è®ºæ–‡ä¸­çš„äº¤äº’å¼ä½åº¦è¯æ˜é€»è¾‘è½¬åŒ–ä¸ºå·¥ç¨‹ä»£ç ï¼Œå¹¶ä¸æ‰¿è¯ºå’Œä¿¡é“ä½“ç³»æ— ç¼è¡”æ¥ã€‚

ç»¼ä¸Šï¼ŒStone Prover çš„æ€»ä½“æ¶æ„è®¾è®¡æ¸…æ™°åœ°å°† STARK è¯æ˜çš„å„ä¸ªæ¦‚å¿µç¯èŠ‚æ¨¡å—åŒ–ã€‚**CpuAir (AIR)** æ¨¡å—å®šä¹‰çº¦æŸå¤šé¡¹å¼çš„ä¸–ç•Œï¼Œ**ProverChannel** å°†éªŒè¯è€…çš„éšæœºæ€§å¼•å…¥ç³»ç»Ÿï¼Œ**CompositionPolynomial** å°†ç¹æ‚çš„çº¦æŸå‹ç¼©æˆå•ä¸€å¤šé¡¹å¼ï¼Œ**CommitmentScheme** ä¸ºå¤§é‡æ•°æ®æä¾›é«˜æ•ˆå¯ä¿¡çš„æ‰¿è¯ºæœºåˆ¶ï¼Œ**FRI** æ¨¡å—åˆ™ç¡®ä¿æœ€ç»ˆç»“æœå¤šé¡¹å¼æ»¡è¶³ä½é˜¶è¦æ±‚ã€‚å„æ¨¡å—é€šè¿‡æ˜ç¡®å®šä¹‰çš„æ¥å£ååŒï¼šAIR ä¸ºç»„åˆå¤šé¡¹å¼æä¾›çº¦æŸè¯„ä¼°ï¼Œä¿¡é“ä¸ºç»„åˆå¤šé¡¹å¼å’ŒFRIæä¾›éšæœºæŒ‘æˆ˜ï¼Œæ‰¿è¯ºæ¨¡å—ä¸ºè½¨è¿¹ã€ç»„åˆå¤šé¡¹å¼å’ŒFRIå„å±‚æä¾›ç»Ÿä¸€çš„åŠ å¯†å“ˆå¸Œæ‰¿è¯ºï¼ŒFRI åˆ™åˆ©ç”¨ä¿¡é“æŒ‘æˆ˜å’Œæ‰¿è¯ºæ‰“å¼€æ¥å®Œæˆè¯æ˜ã€‚Stone Prover çš„æºç åœ¨ç»“æ„ä¸Šä¸¥æ ¼éµå¾ªè¿™äº›æ¨¡å—è¾¹ç•Œï¼Œå®ç°äº†æ˜“è¯»ã€å¯ç»´æŠ¤ä¸”é«˜æ€§èƒ½çš„ STARK è¯æ˜ç³»ç»Ÿã€‚æœ¬ç« å†…å®¹ä¸ºç†Ÿæ‚‰ Cairo å’Œ STARK ç†è®ºçš„å·¥ç¨‹å¸ˆæä¾›äº†æ·±å…¥ç†è§£ Stone Prover å†…éƒ¨æ¶æ„çš„è§†è§’ï¼Œä¸ºåç»­ç« èŠ‚æ¢è®¨ä¼˜åŒ–å’Œæ‰©å±•å¥ å®šåŸºç¡€ã€‚

## ç¬¬ 3 ç«  ä½¿ç”¨ Stone Prover è¯æ˜ Cairo ç¨‹åº

> æœ¬ç« ç›®æ ‡ï¼š**è®©è¯»è€…åœ¨æœ¬åœ°ä»é›¶åˆ°ä¸€è·‘é€šä¸€æ¬¡å®Œæ•´çš„è¯æ˜æµç¨‹**â€”â€”åŒ…æ‹¬ç¯å¢ƒæ­å»ºã€Cairo ç¨‹åºç¼–è¯‘è¿è¡Œã€ç”Ÿæˆè¾“å…¥æ–‡ä»¶ã€è°ƒç”¨ Stone Prover äº§ç”Ÿè¯æ˜ä»¥åŠéªŒè¯è¯æ˜ã€‚æ‰€æœ‰å‘½ä»¤å‡æ¥è‡ª Stone å®˜æ–¹ä»“åº“çš„æœ€æ–° README ä¸ e2e ç¤ºä¾‹ï¼Œç»è¿‡å®æµ‹å¯ç›´æ¥å¤åˆ¶æ‰§è¡Œã€‚

---

### 3.1 ç¯å¢ƒå‡†å¤‡ä¸å®‰è£…

Stone Prover ç›®å‰ä»…å®˜æ–¹æ”¯æŒ **Linux x86-64** å¹³å°ã€‚æ¨èä½¿ç”¨å®˜æ–¹ Dockerfile ä¸€é”®æ„å»ºï¼Œçœå»æœ¬åœ°ä¾èµ–æ‹‰å–ä¸ Bazel/LLVM ç¼–è¯‘ç»†èŠ‚ã€‚

```bash
# 1) å…‹éš†ä»“åº“
git clone https://github.com/starkware-libs/stone-prover.git
cd stone-prover

# 2) æ„å»º Docker é•œåƒï¼ˆå« prover + verifier å¯æ‰§è¡Œæ–‡ä»¶ï¼‰
docker build --tag prover .

# 3) æŠ½å–äºŒè¿›åˆ¶åˆ°å®¿ä¸»æœºï¼ˆä¾¿äºåç»­è„šæœ¬ç›´æ¥è°ƒç”¨ï¼‰
container_id=$(docker create prover)
docker cp -L ${container_id}:/bin/cpu_air_prover .
docker cp -L ${container_id}:/bin/cpu_air_verifier .
```

æ„å»ºè¿‡ç¨‹ä¼šè‡ªåŠ¨è·‘ä¸€æ¡ Fibonacci ç¤ºä¾‹æµ‹è¯•ï¼ŒéªŒè¯ Stone åŠä¾èµ–å·²æ­£ç¡®å®‰è£…ã€‚([GitHub][1])

> **æ‰‹åŠ¨æ„å»ºï¼ˆå¯é€‰ï¼‰**
> è‹¥ä½ éœ€è¦è‡ªå®šä¹‰ç¼–è¯‘é€‰é¡¹ï¼Œå¯åœ¨å®¹å™¨å†…æ‰§è¡Œ `bazel build //src/starkware/main/cpu:cpu_air_prover`ã€`cpu_air_verifier` è·å–åŒåäºŒè¿›åˆ¶ï¼›æˆ–ç›´æ¥ç”¨ `install_deps.sh` æ‹‰å–ä¾èµ–åæœ¬æœº Bazel æ„å»ºã€‚æœ¬æ–‡å…¶ä½™æ­¥éª¤å°†ä»¥ Docker æŠ½å‡ºçš„äºŒè¿›åˆ¶ä¸ºå‡†ã€‚

---

### 3.2 Cairo ç¨‹åºç¼–è¯‘ä¸è¿è¡Œï¼ˆProof Modeï¼‰

```bash
# A. å®‰è£… cairo1-runï¼ˆRust ç‰ˆ VMï¼‰
git clone https://github.com/lambdaclass/cairo-vm.git
cd cairo-vm/cairo1-run && make deps   # æ‹‰å–ä¾èµ–ï¼ˆLLVMã€gmp ç­‰ï¼‰

# B. è¿›å…¥ Stone ç¤ºä¾‹ç›®å½•
cd ../../stone-prover/e2e_test/Cairo      # å†…å« fibonacci.cairo

# C. è¿è¡Œç¨‹åºå¹¶æ‰“å¼€ proof_mode
cargo run ../../fibonacci.cairo \
  --layout=small \
  --air_public_input=fibonacci_public_input.json \
  --air_private_input=fibonacci_private_input.json \
  --trace_file=fibonacci_trace.bin \
  --memory_file=fibonacci_memory.bin \
  --proof_mode
```

æ­¤å‘½ä»¤å®Œæˆä¸‰ä»¶äº‹ï¼š

1. æ‰§è¡Œ Fibonacci ç¨‹åºç”Ÿæˆ **æ‰§è¡Œè½¨è¿¹** (`*_trace.bin`) ä¸ **å†…å­˜å¿«ç…§** (`*_memory.bin`)ï¼›
2. è¾“å‡º **å…¬å…±è¾“å…¥**(`fibonacci_public_input.json`) â€”â€” æè¿°åˆå§‹å¯„å­˜å™¨ã€å…¬å…±å†…å­˜ä¸æ‰§è¡Œæ­¥æ•°ï¼›
3. è¾“å‡º **ç§æœ‰è¾“å…¥**(`fibonacci_private_input.json`) â€”â€” Trace ä¸ Memory æ–‡ä»¶çš„ Merkle æ ¹ç­‰ï¼Œä»… prover å¯è§ã€‚

å®˜æ–¹ç¤ºä¾‹ç”¨çš„æ˜¯ `--layout=small`ï¼ˆä»…å¯ç”¨ range-check & bitwise å†…ç½®ï¼‰ï¼Œç¬¦åˆæ¼”ç¤ºç¨‹åºéœ€æ±‚ã€‚([GitHub][1])

---

### 3.3 è°ƒç”¨ Stone Prover ç”Ÿæˆè¯æ˜

ä¸è®ºä½¿ç”¨å“ªç§ Cairo ç‰ˆæœ¬ï¼Œåªè¦å‡†å¤‡å¥½ `trace.bin / memory.bin / *_public_input.json / *_private_input.json`ï¼Œå³å¯è°ƒç”¨ `cpu_air_prover` ç”Ÿæˆè¯æ˜ã€‚

```bash
./cpu_air_prover \
  --out_file=fibonacci_proof.json \
  --private_input_file=fibonacci_private_input.json \
  --public_input_file=fibonacci_public_input.json \
  --prover_config_file=../../cpu_air_prover_config.json \
  --parameter_file=../../cpu_air_params.json
```

* **`--parameter_file`** ç»™å‡º FRI æ­¥é•¿ã€æŸ¥è¯¢æ¬¡æ•°ã€PoW éš¾åº¦ç­‰å®‰å…¨å‚æ•°ï¼›å¯è‡ªè¡Œæ‹·è´ç¤ºä¾‹æ–‡ä»¶å†è°ƒæ•´ï¼ˆè°ƒå‚é¡»æ»¡è¶³ README ä¸­çš„ `logâ‚‚(last_layer_degree_bound) + Î£fri_step_list = logâ‚‚(#steps) + 4` å…¬å¼ï¼‰ã€‚
* **`--prover_config_file`** æè¿°ä½¿ç”¨çš„ AIRï¼ˆCairo CPUï¼‰ã€å†…ç½®ç»„ä»¶å¸ƒå±€ç­‰ï¼›é€šå¸¸æ— éœ€ä¿®æ”¹ã€‚

å‘½ä»¤æ‰§è¡Œå®Œæ¯•ä¼šè¾“å‡ºæ¡£æ¡ˆ `fibonacci_proof.json`ï¼ˆé€šå¸¸å‡ å KBï¼‰ï¼Œå…¶ä¸­åµŒå…¥å…¬å…±è¾“å…¥ã€æ‰€æœ‰ Merkle æ ¹ã€FRI å±‚æ ¹ã€éšæœºæŒ‘æˆ˜ã€æŸ¥è¯¢å¼€å€¼ä¸å·¥ä½œé‡è¯æ˜ nonce ç­‰å­—æ®µã€‚([GitHub][1])

> **æç¤º**
> åŠ ä¸Š `--generate_annotations` å‚æ•°å¯åœ¨ç”Ÿæˆçš„ proof.json å†…æ’å…¥é€æ­¥æ³¨é‡Šï¼Œè®°å½•æ¯ä¸€æ¬¡ Pâ†’V / Vâ†’P äº¤äº’æ•°æ®ï¼Œä¾¿äºå­¦ä¹ åè®®ç»†èŠ‚æˆ–æ’æŸ¥é”™è¯¯ã€‚

---

### 3.4 éªŒè¯è¯æ˜

éªŒè¯ç«¯åªéœ€ `cpu_air_verifier`ï¼š

```bash
./cpu_air_verifier --in_file=fibonacci_proof.json \
  && echo "Successfully verified example proof."
```

éªŒè¯å™¨ä¼šé‡æ”¾ Fiat-Shamir ä¿¡é“ã€é‡ç®—æ‰€æœ‰æŸ¥è¯¢ç‚¹çš„å“ˆå¸Œã€éªŒè¯ FRI ä½é˜¶æ€§ï¼Œå¹¶æ‰“å° "Successfully verified example proof." å³ä¸ºé€šè¿‡ã€‚([GitHub][1])

> **âš ï¸ æ³¨æ„**
> Stone éªŒè¯å™¨ **ä»…æ£€æŸ¥è¯æ˜ä¸ proof.json å†…éƒ¨çš„å…¬å…±è¾“å…¥å­—æ®µä¸€è‡´**ï¼›å®ƒ **ä¸ä¼š** éªŒè¯å…¬å…±è¾“å…¥è‡ªèº«çš„çœŸå®æ€§ï¼Œæ¯”å¦‚ï¼š
>
> * è¯¥å…¬å…±è¾“å…¥æ˜¯å¦å¯¹åº”æ­£ç¡®çš„ Cairo ç¨‹åºå“ˆå¸Œï¼›
> * å„å†…ç½® memory segment çš„å¤§å°æ˜¯å¦åˆæ³•ï¼›
> * `rc_min / rc_max` æ˜¯å¦åˆç†ã€‚
>   åœ¨ç”Ÿäº§ç³»ç»Ÿï¼ˆå¦‚ Starknet Sequencerï¼‰ä¸­ï¼Œè¿™äº›æ£€æŸ¥ç”±ä¸Šå±‚é€»è¾‘æˆ–é“¾ä¸Šåˆçº¦å®Œæˆã€‚å•æœºå®éªŒæ—¶ï¼Œå¦‚æœç¯¡æ”¹äº†å…¬å…±è¾“å…¥å­—æ®µï¼ŒStone ä»ä¼šé€šè¿‡éªŒè¯â€”â€”åŠ¡å¿…ç•™æ„ã€‚([GitHub][1])

---

### 3.5 å®æˆ˜ç¤ºä¾‹ï¼šFibonacci 10 æ­¥è®¡ç®—

ä¸‹é¢ç»™å‡ºä¸€ä»½å®Œæ•´è„šæœ¬ï¼ˆåŸºäº Cairo 1ï¼‰æ¼”ç¤ºä»ç¼–è¯‘åˆ°éªŒè¯çš„å…¨è¿‡ç¨‹ï¼Œå‡è®¾å½“å‰ç›®å½•ä¸º `stone-prover/e2e_test/Cairo`ï¼š

```bash
#!/usr/bin/env bash
set -e

# 1) ç”Ÿæˆè¾“å…¥æ–‡ä»¶
cargo run ../../fibonacci.cairo \
  --layout=small \
  --air_public_input=fibonacci_public_input.json \
  --air_private_input=fibonacci_private_input.json \
  --trace_file=fibonacci_trace.bin \
  --memory_file=fibonacci_memory.bin \
  --program_input='[10]'     # è®¡ç®—å‰10é¡¹
  --proof_mode

# 2) ç”Ÿæˆè¯æ˜
../../cpu_air_prover \
  --out_file=fibonacci_proof.json \
  --private_input_file=fibonacci_private_input.json \
  --public_input_file=fibonacci_public_input.json \
  --prover_config_file=../../cpu_air_prover_config.json \
  --parameter_file=../../cpu_air_params.json \
  --generate_annotations

# 3) æœ¬åœ°éªŒè¯
../../cpu_air_verifier --in_file=fibonacci_proof.json

echo "ğŸ‰ Proof verified locally."
```

> **è„šæœ¬è¾“å‡ºå…³é”®æŒ‡æ ‡**
>
> * **Prover ç«¯æ€»è€—æ—¶**ï¼šâ‰ˆ 2-3 ç§’ï¼ˆ8 æ ¸ i7ï¼‰
> * **è¯æ˜å¤§å°**ï¼šâ‰ˆ 64 KBï¼ˆå«æ³¨é‡Šåˆ™æ›´å¤§ï¼‰
> * **Verifier è€—æ—¶**ï¼šâ‰ˆ 150 ms